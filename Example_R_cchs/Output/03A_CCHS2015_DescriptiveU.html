<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAAAZwABAAAAAACFQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABEU0lHAAAGaAAAAAgAAAAIAAAAAUdTVUIAAAZcAAAACgAAAAoAAQAAT1MvMgAAAyQAAABJAAAAYFYEU3RjbWFwAAADcAAAAEUAAACAAJThvmN2dCAAAATkAAAABAAAAAQAAAAAZnBnbQAAA7gAAACyAAABCUM+8IhnYXNwAAAGTAAAABAAAAAQABoAI2dseWYAAAFsAAABPAAAAZwcEq9taGVhZAAAAsgAAAA0AAAANgh4a91oaGVhAAADCAAAABoAAAAkCA8DRGhtdHgAAAL8AAAADAAAAAwGAACfbG9jYQAAAsAAAAAIAAAACABiATBtYXhwAAACqAAAABgAAAAgAA8ASm5hbWUAAAToAAABQgAAAlXu73sOcG9zdAAABiwAAAAeAAAAME3QpOBwcmVwAAAEbAAAAHYAAAB/aFGpk3jaTY6xa8JAGMW/O62BDi0tJLYQincXEypYIiGJjSgHniQ6umTsUEyLm5BV6NDBP8Tpts6F0v+k/0an2i+itHDw3v2+9+DBKTzsJNnWJNTgHEy4BgG3EMI9DCEDOGEXzDADU5hBKMIgNPZqoD3SilVaXZCER3/I7AtxEJLtzzuZfI+VVkprxTlXShWKb3TBecG11rwoNlmmn1P2WYcJczl32etSpKnziC7lQyWe1smVPy/Lt7Kc+0vWY/gAgIIEqAN9we0pwKXreiMasxvabDQMM4riO+qxM2ogwDGOZTXxwxDiycQIcoYFBLj5K3EIaSctAq2kTYiw+ymhce7vwM9jSqO8JyVd5RH9gyTt2+J/yUmYlIR0s04n6+7Vm1ozezUeLEaUjhaDSuXHwVRgvLJn1tQ7xiuVv/ocTRF42mNgZGBgYGbwZOBiAAFGJBIMAAizAFoAAABiAGIAznjaY2BkYGAA4in8zwXi+W2+MjCzMIDApSwvXzC97Z4Ig8N/BxYGZgcgl52BCSQKAA3jCV8CAABfAAAAAAQAAEB42mNgZGBg4f3vACQZQABIMjKgAmYAKEgBXgAAeNpjYGY6wTiBgZWBg2kmUxoDA4MPhGZMYzBi1AHygVLYQUCaawqDA4PChxhmh/8ODDEsvAwHgMKMIDnGL0x7gJQCAwMAJd4MFwAAAHjaY2BgYGaA4DAGRgYQkAHyGMF8NgYrIM3JIAGVYYDT+AEjAwuDFpBmA9KMDEwMCh9i/v8H8sH0/4dQc1iAmAkALaUKLgAAAHjaTY9LDsIgEIbtgqHUPpDi3gPoBVyRTmTddOmqTXThEXqrob2gQ1FjwpDvfwCBdmdXC5AVKFu3e5MfNFJ29KTQT48Ob9/lqYwOGZxeUelN2U2R6+cArgtCJpauW7UQBqnFkUsjAY/kOU1cP+DAgvxwn1chZDwUbd6CFimGXwzwF6tPbFIcjEl+vvmM/byA48e6tWrKArm4ZJlCbdsrxksL1AwWn/yBSJKpYbq8AXaaTb8AAHja28jAwOC00ZrBeQNDQOWO//sdBBgYGRiYWYAEELEwMTE4uzo5Zzo5b2BxdnFOcALxNjA6b2ByTswC8jYwg0VlNuoCTWAMqNzMzsoK1rEhNqByEyerg5PMJlYuVueETKcd/89uBpnpvIEVomeHLoMsAAe1Id4AAAAAAAB42oWQT07CQBTGv0JBhagk7HQzKxca2sJCE1hDt4QF+9JOS0nbaaYDCQfwCJ7Au3AHj+LO13FMmm6cl7785vven0kBjHCBhfpYuNa5Ph1c0e2Xu3jEvWG7UdPDLZ4N92nOm+EBXuAbHmIMSRMs+4aUEd4Nd3CHD8NdvOLTsA2GL8M9PODbcL+hD7C1xoaHeLJSEao0FEW14ckxC+TU8TxvsY6X0eLPmRhry2WVioLpkrbp84LLQPGI7c6sOiUzpWIWS5GzlSgUzzLBSikOPFTOXqly7rqx0Z1Q5BAIoZBSFihQYQOOBEdkCOgXTOHA07HAGjGWiIjaPZNW13/+lm6S9FT7rLHFJ6fQbkATOG1j2OFMucKJJsxIVfQORl+9Jyda6Sl1dUYhSCm1dyClfoeDve4qMYdLEbfqHf3O/AdDumsjAAB42mNgYoAAZQYjBmyAGYQZmdhL8zLdDEydARfoAqIAAAABAAMABwAKABMAB///AA8AAQAAAAAAAAAAAAAAAAABAAAAAA==) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
box-sizing: border-box;
min-width: 200px;
max-width: 980px;
margin: 0 auto;
padding: 45px;
padding-top: 0px;
}
</style>


</head>

<body>

<h1 id="descriptive-statistics-based-on-repeated-24-h-recall-hefi-2019-scores-using-the-nci-multivariate-method---model-and-simulations">Descriptive
statistics based on repeated 24-h recall: HEFI-2019 scores using the NCI
multivariate method - model and simulations</h1>
<p>Didier Brassard 2025-05-23</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#                      CCHS 2015 - Nutrition (PUMF)                       #</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="co">#          Descriptive statistics based on repeated 24-h recall           #</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co">#                        Author: Didier Brassard                          #</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="co">#                              Version 1.0                                #</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a><span class="co">#                               2025-05-23                                #</span></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># </span><span class="al">NOTE</span><span class="co">: This code assumes that &lt;01_CCHS2015_Data_preparation.R&gt;           #</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># was executed beforehand.                                                #</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="do">#### General set-up: packages and location of files ####</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#             General set-up: packages and location of files              #</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span></code></pre></div>
<p>Note 1: a hard coded path (&lt;external_drive&gt;) is used since
files are on an external drive. Usually we would want analysis to be
self-contained, but survey files are a bit large. Also, the data are set
up exactly as they are once obtained from Statistics Canada</p>
<p>Note 2: data pertaining to the 2015 Canadian Community Health Survey
- Nutrition (Public Use Microdata Files) are available upon request to
Statistics Canada online: <a href="https://www150.statcan.gc.ca/n1/en/catalogue/82M0024X2018001">https://www150.statcan.gc.ca/n1/en/catalogue/82M0024X2018001</a></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># TO DO: Update CCHS 2015 - Nutrition file location</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>external_drive <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;&quot;</span>,<span class="st">&quot;Volumes&quot;</span>,<span class="st">&quot;SANDISK DID&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="do">## (auto) create shortcuts for raw CCHS 2015 - Nutrition file location</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>boot_dir <span class="ot">&lt;-</span> <span class="fu">file.path</span>(external_drive,<span class="st">&quot;CCHS_Nutrition_2015_PUMF&quot;</span>,<span class="st">&quot;Bootstrap&quot;</span>,<span class="st">&quot;Data_Donnee&quot;</span>)</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># (auto) create shortcuts for project directory tree</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="do">## Common directory</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>dir_example <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;Example_R_cchs&quot;</span>)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>dir_processed <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_example,<span class="st">&quot;data&quot;</span>, <span class="st">&quot;processed&quot;</span>)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>dir_temp <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_example,<span class="st">&quot;data&quot;</span>, <span class="st">&quot;temp&quot;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="do">## For the NCI output</span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>dir_nci <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_example, <span class="st">&quot;data&quot;</span>, <span class="st">&quot;nci_mcmc&quot;</span>)</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>dir_nci_original <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_nci, <span class="st">&quot;original&quot;</span>)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>dir_nci_output <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_nci, <span class="st">&quot;output&quot;</span>)</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>dir_nci_bootstrap <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_nci,<span class="st">&quot;bootstrap&quot;</span>)</span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>dir_nci_traceplot <span class="ot">&lt;-</span> <span class="fu">file.path</span>(dir_nci,<span class="st">&quot;traceplot&quot;</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>  <span class="do">### create folders, if need be</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">dir.exists</span>(dir_nci)<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_nci, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>  }</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">dir.exists</span>(dir_nci_original)<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_nci_original, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>  }</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">dir.exists</span>(dir_nci_output)<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_nci_output, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>  }</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">dir.exists</span>(dir_nci_bootstrap)<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_nci_bootstrap, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>  }</span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">dir.exists</span>(dir_nci_traceplot)<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>    <span class="fu">dir.create</span>(dir_nci_traceplot, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>  }</span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co"># Packages</span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="do">## data management</span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="fu">library</span>(data.table)</span></code></pre></div>
<pre><code>## data.table 1.17.99 IN DEVELOPMENT built 2025-03-29 04:23:09 UTC; root using 4 threads (see ?getDTthreads).  Latest news: r-datatable.com
## **********
## This development version of data.table was built more than 4 weeks ago. Please update: data.table::update_dev_pkg()
## **********</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;
## 
## The following objects are masked from &#39;package:data.table&#39;:
## 
##     between, first, last
## 
## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag
## 
## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">library</span>(tidylog)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;tidylog&#39;
## 
## The following objects are masked from &#39;package:dplyr&#39;:
## 
##     add_count, add_tally, anti_join, count, distinct, distinct_all, distinct_at, distinct_if, filter,
##     filter_all, filter_at, filter_if, full_join, group_by, group_by_all, group_by_at, group_by_if,
##     inner_join, left_join, mutate, mutate_all, mutate_at, mutate_if, relocate, rename, rename_all, rename_at,
##     rename_if, rename_with, right_join, sample_frac, sample_n, select, select_all, select_at, select_if,
##     semi_join, slice, slice_head, slice_max, slice_min, slice_sample, slice_tail, summarise, summarise_all,
##     summarise_at, summarise_if, summarize, summarize_all, summarize_at, summarize_if, tally, top_frac, top_n,
##     transmute, transmute_all, transmute_at, transmute_if, ungroup
## 
## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">## NCI multivariate method</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">library</span>(ncimultivar)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="do">## computing</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">library</span>(tictoc)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;tictoc&#39;
## 
## The following object is masked from &#39;package:data.table&#39;:
## 
##     shift</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">library</span>(doFuture)</span></code></pre></div>
<pre><code>## Loading required package: foreach</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">library</span>(furrr)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="fu">library</span>(foreach)</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co"># suppress scientific notation</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">9999</span>)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="do">#### Prepare data suitable to apply the multivariate method ####</span></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a><span class="co">#         Prepare data suitable to apply the multivariate method          #</span></span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span></code></pre></div>
<p>note1: for the NCI method, an input data frame in long (or tall)
format is required, where repeated 24-h dietary recall appear on
separate rows.</p>
<p>note2: for this example, we focus on children aged 13-17
inclusively.</p>
<p>note3: we remove 24-h dietary recall with less than 250 kcal. This
cut-off is used since intakes &lt;250 kcal cannot plausibly inform
hypothetical unobserved usual intakes (long-term average), but it is
challenging to decide which energy cut-off value is plausibly related to
long-term intakes beyond that.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#            Intake + sociodemo data             #</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co"># 1) load prepared CCHS data</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="do">## Summary nutrient intakes and sociodemographic characteristics</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="fu">file.path</span>(dir_processed, <span class="st">&quot;CCHS2015_HS_NCI.rdata&quot;</span>))</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="fu">dim</span>(CCHS2015_HS_NCI); <span class="fu">names</span>(CCHS2015_HS_NCI)</span></code></pre></div>
<pre><code>## [1] 27544    19

##  [1] &quot;ADM_RNO&quot;     &quot;WTS_P&quot;       &quot;SUPPID&quot;      &quot;r24_day&quot;     &quot;r24_month&quot;   &quot;r24_nfoods&quot;  &quot;province&quot;    &quot;age&quot;        
##  [9] &quot;sex&quot;         &quot;drig&quot;        &quot;education&quot;   &quot;smoking&quot;     &quot;r24_weekend&quot; &quot;foodwgt&quot;     &quot;energy&quot;      &quot;sodium&quot;     
## [17] &quot;sfa&quot;         &quot;mufa&quot;        &quot;pufa&quot;</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## Dietary constituents required for the HEFI-2019</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="fu">file.path</span>(dir_processed, <span class="st">&quot;CCHS2015_HEFI2019_PER24HR.rdata&quot;</span>))</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="fu">dim</span>(CCHS2015_HEFI2019_PER24HR); <span class="fu">names</span>(CCHS2015_HEFI2019_PER24HR)</span></code></pre></div>
<pre><code>## [1] 27544    19

##  [1] &quot;ADM_RNO&quot;        &quot;SUPPID&quot;         &quot;wg&quot;             &quot;rg&quot;             &quot;pfab&quot;           &quot;pfpb&quot;           &quot;otherfoods&quot;    
##  [8] &quot;vf&quot;             &quot;water&quot;          &quot;otherbevs&quot;      &quot;milk&quot;           &quot;plantbev&quot;       &quot;freesugars&quot;     &quot;energy&quot;        
## [15] &quot;sfa&quot;            &quot;mufa&quot;           &quot;pufa&quot;           &quot;sodium&quot;         &quot;nonzero_energy&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># 2) Merge both data by respondent and recall identifiers</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>intake_and_sociodeom <span class="ot">&lt;-</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>  <span class="fu">full_join</span>(<span class="at">x  =</span> CCHS2015_HS_NCI <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a>              <span class="fu">select</span>(<span class="st">&quot;ADM_RNO&quot;</span>, <span class="st">&quot;WTS_P&quot;</span>, <span class="st">&quot;SUPPID&quot;</span>,</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a>                     <span class="st">&quot;r24_weekend&quot;</span>, <span class="st">&quot;drig&quot;</span>, <span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>),</span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a>            <span class="at">y  =</span> CCHS2015_HEFI2019_PER24HR,</span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ADM_RNO&quot;</span>, <span class="st">&quot;SUPPID&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a>  <span class="co"># focus on children with age [13, 17] with 250 kcal or more</span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a>  <span class="fu">filter</span>(age<span class="sc">&gt;</span><span class="dv">12</span> <span class="sc">&amp;</span> age<span class="sc">&lt;</span><span class="dv">18</span> ) <span class="sc">|&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a>  <span class="fu">filter</span>(energy<span class="sc">&gt;=</span><span class="dv">250</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a>  <span class="co"># create dummy indicator for DRI age/sex group + 2nd recall</span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a>    <span class="at">r24_day2 =</span> <span class="fu">ifelse</span>(SUPPID<span class="sc">==</span><span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a>    <span class="at">drig_m_9_13  =</span> <span class="fu">ifelse</span>(drig<span class="sc">==</span><span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a>    <span class="at">drig_f_9_13  =</span> <span class="fu">ifelse</span>(drig<span class="sc">==</span><span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb17-16"><a href="#cb17-16" tabindex="-1"></a>    <span class="at">drig_m_14_18 =</span> <span class="fu">ifelse</span>(drig<span class="sc">==</span><span class="dv">6</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb17-17"><a href="#cb17-17" tabindex="-1"></a>    <span class="at">drig_f_14_18 =</span> <span class="fu">ifelse</span>(drig<span class="sc">==</span><span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb17-18"><a href="#cb17-18" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-19"><a href="#cb17-19" tabindex="-1"></a>  <span class="co"># drop extra variables</span></span>
<span id="cb17-20"><a href="#cb17-20" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;WTS_P&quot;</span>, <span class="st">&quot;nonzero_energy&quot;</span>))</span></code></pre></div>
<pre><code>## select: dropped 12 variables (r24_day, r24_month, r24_nfoods, province, education, …)
## full_join: added 17 columns (wg, rg, pfab, pfpb, otherfoods, …)
##            &gt; rows only in select(CCHS2015_HS_NCI,..       0
##            &gt; rows only in CCHS2015_HEFI2019_PER24HR       0
##            &gt; matched rows                            27,544
##            &gt;                                        ========
##            &gt; rows total                              27,544
## filter: removed 24,491 rows (89%), 3,053 rows remaining
## filter: removed 9 rows (&lt;1%), 3,044 rows remaining
## mutate: new variable &#39;r24_day2&#39; (double) with 2 unique values and 0% NA
##         new variable &#39;drig_m_9_13&#39; (double) with 2 unique values and 0% NA
##         new variable &#39;drig_f_9_13&#39; (double) with 2 unique values and 0% NA
##         new variable &#39;drig_m_14_18&#39; (double) with 2 unique values and 0% NA
##         new variable &#39;drig_f_14_18&#39; (double) with 2 unique values and 0% NA
## select: dropped 2 variables (WTS_P, nonzero_energy)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># note: A total of 10x 24-h dietary recalls had energy &lt;250 kcal</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a><span class="do">## overview</span></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="fu">dim</span>(intake_and_sociodeom); <span class="fu">names</span>(intake_and_sociodeom)</span></code></pre></div>
<pre><code>## [1] 3044   27

##  [1] &quot;ADM_RNO&quot;      &quot;SUPPID&quot;       &quot;r24_weekend&quot;  &quot;drig&quot;         &quot;sex&quot;          &quot;age&quot;          &quot;wg&quot;          
##  [8] &quot;rg&quot;           &quot;pfab&quot;         &quot;pfpb&quot;         &quot;otherfoods&quot;   &quot;vf&quot;           &quot;water&quot;        &quot;otherbevs&quot;   
## [15] &quot;milk&quot;         &quot;plantbev&quot;     &quot;freesugars&quot;   &quot;energy&quot;       &quot;sfa&quot;          &quot;mufa&quot;         &quot;pufa&quot;        
## [22] &quot;sodium&quot;       &quot;r24_day2&quot;     &quot;drig_m_9_13&quot;  &quot;drig_f_9_13&quot;  &quot;drig_m_14_18&quot; &quot;drig_f_14_18&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>intake_and_sociodeom <span class="sc">|&gt;</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">&quot;SUPPID&quot;</span>, <span class="st">&quot;wg&quot;</span><span class="sc">:</span><span class="st">&quot;sodium&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">tbl_summary</span>(</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">&quot;SUPPID&quot;</span>,</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>    <span class="at">statistic =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;vf&quot;</span>,<span class="st">&quot;wg&quot;</span>, <span class="st">&quot;rg&quot;</span>, <span class="st">&quot;pfab&quot;</span>,<span class="st">&quot;pfpb&quot;</span>,<span class="st">&quot;otherfoods&quot;</span>,</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>                       <span class="st">&quot;water&quot;</span>, <span class="st">&quot;otherbevs&quot;</span>, <span class="st">&quot;milk&quot;</span>,</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a>                       <span class="st">&quot;energy&quot;</span>, <span class="st">&quot;sfa&quot;</span>, <span class="st">&quot;mufa&quot;</span>, <span class="st">&quot;pufa&quot;</span>, <span class="st">&quot;sodium&quot;</span>) <span class="sc">~</span> <span class="st">&quot;{mean} [{min} to {max}]&quot;</span>),</span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">modify_caption</span>(<span class="st">&quot;Mean HEFI-2019 dietary constituents and range (CCHS 2015 - Nutrition), by 24-h dietary recall&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  gtsummary<span class="sc">::</span><span class="fu">as_kable</span>()</span></code></pre></div>
<pre><code>## select: dropped 10 variables (ADM_RNO, r24_weekend, drig, sex, age, …)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"><strong>Characteristic</strong></th>
<th align="center"><strong>1</strong> N = 2,025</th>
<th align="center"><strong>2</strong> N = 1,019</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Whole grain foods, RA/d</td>
<td align="center">0.87 [0.00 to 18.96]</td>
<td align="center">0.75 [0.00 to 11.63]</td>
</tr>
<tr class="even">
<td align="left">Non-whole grain foods, RA/d</td>
<td align="center">2.62 [0.00 to 25.97]</td>
<td align="center">2.44 [0.00 to 24.19]</td>
</tr>
<tr class="odd">
<td align="left">Protein foods, animal-based, RA/d (excludes bev.)</td>
<td align="center">2.36 [0.00 to 27.39]</td>
<td align="center">2.29 [0.00 to 26.75]</td>
</tr>
<tr class="even">
<td align="left">Protein foods, plant-based, RA/d (excludes bev.)</td>
<td align="center">0.46 [0.00 to 38.49]</td>
<td align="center">0.32 [0.00 to 8.27]</td>
</tr>
<tr class="odd">
<td align="left">Other foods, RA/d</td>
<td align="center">4.5 [0.0 to 51.7]</td>
<td align="center">3.7 [0.0 to 106.1]</td>
</tr>
<tr class="even">
<td align="left">Vegetables and fruits, RA/d</td>
<td align="center">2.62 [0.00 to 19.67]</td>
<td align="center">2.46 [0.00 to 14.77]</td>
</tr>
<tr class="odd">
<td align="left">Water and unsweetened beverages, g/d</td>
<td align="center">926 [0 to 8,449]</td>
<td align="center">820 [0 to 5,609]</td>
</tr>
<tr class="even">
<td align="left">Other (sweetened) beverages, g/d</td>
<td align="center">465 [0 to 3,862]</td>
<td align="center">359 [0 to 1,994]</td>
</tr>
<tr class="odd">
<td align="left">Unsweetened milk, g/d</td>
<td align="center">221 [0 to 3,682]</td>
<td align="center">209 [0 to 2,044]</td>
</tr>
<tr class="even">
<td align="left">Unsweetened plant-based bev. with protein, g/d</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td align="left">0</td>
<td align="center">2,025 (100%)</td>
<td align="center">1,019 (100%)</td>
</tr>
<tr class="even">
<td align="left">Total free sugars, g/d</td>
<td align="center">66 (38, 109)</td>
<td align="center">52 (27, 89)</td>
</tr>
<tr class="odd">
<td align="left">Total energy, kcal/d</td>
<td align="center">2,048 [267 to 13,651]</td>
<td align="center">1,822 [301 to 5,758]</td>
</tr>
<tr class="even">
<td align="left">Total saturated fats, g/d</td>
<td align="center">26 [1 to 196]</td>
<td align="center">24 [0 to 176]</td>
</tr>
<tr class="odd">
<td align="left">Total monounsaturated fats, g/d</td>
<td align="center">27 [0 to 233]</td>
<td align="center">25 [0 to 113]</td>
</tr>
<tr class="even">
<td align="left">Total polyunsaturated fats, g/d</td>
<td align="center">15 [0 to 166]</td>
<td align="center">13 [1 to 74]</td>
</tr>
<tr class="odd">
<td align="left">Total sodium, mg/d</td>
<td align="center">2,929 [162 to 20,121]</td>
<td align="center">2,701 [139 to 10,944]</td>
</tr>
</tbody>
</table>
<p>Mean HEFI-2019 dietary constituents and range (CCHS 2015 -
Nutrition), by 24-h dietary recall</p>
<p>note: unsweetened plant-based beverages with sufficient protein have
not been reported (all values=0).</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="do">## confirm recoding</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">with</span>(intake_and_sociodeom, <span class="fu">table</span>(drig, drig_m_9_13))</span></code></pre></div>
<pre><code>##     drig_m_9_13
## drig    0    1
##    4    0  308
##    5  290    0
##    6 1157    0
##    7 1289    0</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">with</span>(intake_and_sociodeom, <span class="fu">table</span>(drig, drig_f_9_13))</span></code></pre></div>
<pre><code>##     drig_f_9_13
## drig    0    1
##    4  308    0
##    5    0  290
##    6 1157    0
##    7 1289    0</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="fu">with</span>(intake_and_sociodeom, <span class="fu">table</span>(drig, drig_m_14_18))</span></code></pre></div>
<pre><code>##     drig_m_14_18
## drig    0    1
##    4  308    0
##    5  290    0
##    6    0 1157
##    7 1289    0</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">with</span>(intake_and_sociodeom, <span class="fu">table</span>(drig, drig_f_14_18))</span></code></pre></div>
<pre><code>##     drig_f_14_18
## drig    0    1
##    4  308    0
##    5  290    0
##    6 1157    0
##    7    0 1289</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="fu">with</span>(intake_and_sociodeom, <span class="fu">table</span>(SUPPID, r24_day2))</span></code></pre></div>
<pre><code>##       r24_day2
## SUPPID    0    1
##      1 2025    0
##      2    0 1019</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a><span class="co">#             Bootstrap weight data              #</span></span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a><span class="co"># ********************************************** #</span></span></code></pre></div>
<p>note: variance is estimated using (500) bootstrap replicate weights
in CCHS 2015 - Nutrition.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a><span class="co"># 1) output list of (unique) respondent to output BSW data</span></span>
<span id="cb34-2"><a href="#cb34-2" tabindex="-1"></a>respondent_list <span class="ot">&lt;-</span></span>
<span id="cb34-3"><a href="#cb34-3" tabindex="-1"></a>  intake_and_sociodeom <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" tabindex="-1"></a>  <span class="fu">distinct</span>(ADM_RNO)</span></code></pre></div>
<pre><code>## distinct: removed 1,018 rows (33%), 2,026 rows remaining</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="fu">dim</span>(respondent_list); <span class="fu">names</span>(respondent_list)</span></code></pre></div>
<pre><code>## [1] 2026    1

## [1] &quot;ADM_RNO&quot;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a><span class="co"># 2) Load and prepare bootstrap replicate weights</span></span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>bsw <span class="ot">&lt;-</span></span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">fread</span>(<span class="fu">file.path</span>(boot_dir,<span class="st">&quot;b5.txt&quot;</span>),</span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a>                    <span class="at">stringsAsFactors =</span> F, <span class="at">data.table=</span> F, <span class="at">header=</span>F,</span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>                    <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;ADM_RNO&quot;</span>,<span class="st">&quot;WTS_P&quot;</span>,<span class="fu">paste0</span>(<span class="st">&quot;BSW&quot;</span>,<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">500</span>))))</span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a><span class="co"># save complete bsw data for further analysis</span></span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a><span class="fu">save</span>(bsw, <span class="at">file =</span> <span class="fu">file.path</span>(dir_temp, <span class="st">&quot;bsw.rdata&quot;</span>))</span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a><span class="co"># keep only (unique) respondents from &#39;preNCI&#39;</span></span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>bsw <span class="ot">&lt;-</span></span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a>  bsw <span class="sc">|&gt;</span></span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a>  <span class="fu">right_join</span>(respondent_list,</span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">&quot;ADM_RNO&quot;</span>) <span class="sc">|&gt;</span></span>
<span id="cb38-16"><a href="#cb38-16" tabindex="-1"></a>  <span class="co"># rename sampling weights</span></span>
<span id="cb38-17"><a href="#cb38-17" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">BSW0=</span>WTS_P)</span></code></pre></div>
<pre><code>## right_join: added no columns
##             &gt; rows only in bsw             (18,461)
##             &gt; rows only in respondent_list       0
##             &gt; matched rows                   2,026
##             &gt;                              ========
##             &gt; rows total                     2,026
## rename: renamed one variable (BSW0)</code></pre>
<p>note: all rows from ‘preNCI_respondent_list’ should be matched</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="do">#### Preliminary step: daily vs. episodic items, variable definition ####</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a><span class="co">#    Preliminary step: daily vs. episodic items, variable definition      #</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a><span class="co"># 1) Check proportion of &#39;zero&#39; among dietary constituents based on first 24-h dietary recall 1</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>intake_day1 <span class="ot">&lt;-</span></span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a>  intake_and_sociodeom <span class="sc">|&gt;</span></span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a>  <span class="fu">filter</span>(SUPPID<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb40-12"><a href="#cb40-12" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">&quot;wg&quot;</span><span class="sc">:</span><span class="st">&quot;sodium&quot;</span>)</span></code></pre></div>
<pre><code>## filter: removed 1,019 rows (33%), 2,025 rows remaining
## select: dropped 11 variables (ADM_RNO, SUPPID, r24_weekend, drig, sex, …)</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>proportions <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="at">length =</span> <span class="fu">ncol</span>(intake_day1))</span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(intake_day1)) {</span>
<span id="cb42-4"><a href="#cb42-4" tabindex="-1"></a>  <span class="co"># Calculate mean proportion of values equal to 0 in each column</span></span>
<span id="cb42-5"><a href="#cb42-5" tabindex="-1"></a>  proportions[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(intake_day1[[i]] <span class="sc">==</span> <span class="dv">0</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb42-6"><a href="#cb42-6" tabindex="-1"></a>}</span>
<span id="cb42-7"><a href="#cb42-7" tabindex="-1"></a><span class="co"># add names for clarity</span></span>
<span id="cb42-8"><a href="#cb42-8" tabindex="-1"></a>proportions <span class="ot">&lt;-</span> <span class="fu">setNames</span>(proportions, <span class="fu">names</span>(intake_day1))</span>
<span id="cb42-9"><a href="#cb42-9" tabindex="-1"></a></span>
<span id="cb42-10"><a href="#cb42-10" tabindex="-1"></a><span class="co"># Print Pr(X=0) for each dietary constituents, descending order:</span></span>
<span id="cb42-11"><a href="#cb42-11" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">round</span>(proportions<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>), <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##   plantbev       pfpb         wg       milk  otherbevs      water       pfab         vf         rg otherfoods freesugars 
##      100.0       75.2       48.0       36.0       24.0        7.2        5.9        5.7        4.9        4.6        0.4 
##     energy        sfa       mufa       pufa     sodium 
##        0.0        0.0        0.0        0.0        0.0</code></pre>
<p>note: pfpb, wg, milk and otherbevs would be episodically-consumed
dietary constituents based on a cut-off of 10% of zero.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="co"># 2) Create vector of variables to be used within the NCI multivariate algorithm</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a></span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a><span class="do">## covariates</span></span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>vars_z <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;r24_weekend&quot;</span>, <span class="st">&quot;r24_day2&quot;</span>, <span class="st">&quot;drig_f_9_13&quot;</span>, <span class="st">&quot;drig_m_14_18&quot;</span>, <span class="st">&quot;drig_f_14_18&quot;</span>)</span></code></pre></div>
<p>note: the ‘drig_m_9_13’ dummy variable is omitted, so k-1 dummy are
used in the model, where k is the number of level based on the original
DRI group variable for that sample (k=4).</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="do">## diet and nutrients</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>vars_diet_episodic <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;pfpb&quot;</span>, <span class="st">&quot;wg&quot;</span>, <span class="st">&quot;milk&quot;</span>, <span class="st">&quot;otherbevs&quot;</span>)</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>vars_diet_daily <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;water&quot;</span>, <span class="st">&quot;pfab&quot;</span>, <span class="st">&quot;vf&quot;</span>, <span class="st">&quot;rg&quot;</span>, <span class="st">&quot;otherfoods&quot;</span>, <span class="st">&quot;freesugars&quot;</span>, <span class="st">&quot;energy&quot;</span>, <span class="st">&quot;sfa&quot;</span>, <span class="st">&quot;mufa&quot;</span>, <span class="st">&quot;pufa&quot;</span>, <span class="st">&quot;sodium&quot;</span>)</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>vars_diet_all <span class="ot">&lt;-</span> <span class="fu">c</span>(vars_diet_episodic, vars_diet_daily)</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a><span class="do">## misc and identifiers</span></span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>participant_id <span class="ot">&lt;-</span> <span class="st">&quot;ADM_RNO&quot;</span></span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>recall_id <span class="ot">&lt;-</span> <span class="st">&quot;SUPPID&quot;</span></span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>wts_sample <span class="ot">&lt;-</span> <span class="st">&quot;BSW0&quot;</span></span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a><span class="co"># 3) Output &#39;preNCI&#39; data for analysis</span></span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>preNCI <span class="ot">&lt;-</span></span>
<span id="cb45-13"><a href="#cb45-13" tabindex="-1"></a>  intake_and_sociodeom <span class="sc">|&gt;</span></span>
<span id="cb45-14"><a href="#cb45-14" tabindex="-1"></a>  <span class="co"># merge with original sample weight (coded as BSW0) for preliminary NCI steps</span></span>
<span id="cb45-15"><a href="#cb45-15" tabindex="-1"></a>  <span class="fu">left_join</span>(bsw <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="st">&quot;ADM_RNO&quot;</span>, <span class="st">&quot;BSW0&quot;</span>)) <span class="sc">|&gt;</span></span>
<span id="cb45-16"><a href="#cb45-16" tabindex="-1"></a>  <span class="co"># tidy data to include only variables required for NCI</span></span>
<span id="cb45-17"><a href="#cb45-17" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(participant_id), <span class="fu">all_of</span>(recall_id),</span>
<span id="cb45-18"><a href="#cb45-18" tabindex="-1"></a>         <span class="fu">all_of</span>(vars_z), <span class="fu">all_of</span>(vars_diet_all), <span class="fu">all_of</span>(wts_sample))</span></code></pre></div>
<pre><code>## select: dropped 500 variables (BSW1, BSW2, BSW3, BSW4, BSW5, …)
## Joining with `by = join_by(ADM_RNO)`
## left_join: added one column (BSW0)
##            &gt; rows only in intake_and_sociodeom           0
##            &gt; rows only in select(bsw, &quot;ADM_RNO&quot;, .. (    0)
##            &gt; matched rows                            3,044
##            &gt;                                        =======
##            &gt; rows total                              3,044
## select: dropped 5 variables (drig, sex, age, plantbev, drig_m_9_13)</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co"># confirm lack of missing values:</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(preNCI[,<span class="fu">c</span>(vars_diet_all, vars_z, wts_sample)]))</span></code></pre></div>
<pre><code>##         pfpb           wg         milk    otherbevs        water         pfab           vf           rg   otherfoods 
##            0            0            0            0            0            0            0            0            0 
##   freesugars       energy          sfa         mufa         pufa       sodium  r24_weekend     r24_day2  drig_f_9_13 
##            0            0            0            0            0            0            0            0            0 
## drig_m_14_18 drig_f_14_18         BSW0 
##            0            0            0</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">sum</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(preNCI[,<span class="fu">c</span>(vars_diet_all, vars_z, wts_sample)])))<span class="sc">==</span><span class="dv">0</span>) <span class="fu">print</span>(<span class="st">&quot;No missing values.&quot;</span>) <span class="cf">else</span> <span class="fu">message</span>(<span class="st">&quot;Warning! Some values are missing!&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;No missing values.&quot;</code></pre>
<p>note: should show zero missing values for all variables</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="co"># Save preNCI data and bootstrap sample weights for reference and/or future analysis</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a><span class="fu">save</span>(preNCI,bsw,</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_original, <span class="st">&quot;preNCI_n_bsw.rdata&quot;</span>))</span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a><span class="co"># Save predefined vectors for reference and/or analysis</span></span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a><span class="fu">save</span>(vars_z, vars_diet_episodic, vars_diet_daily, vars_diet_all, participant_id, recall_id,</span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_original, <span class="st">&quot;predefined_vectors.rdata&quot;</span>))</span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" tabindex="-1"></a><span class="do">#### National Cancer Institute Multivariate Method ####</span></span>
<span id="cb51-10"><a href="#cb51-10" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb51-11"><a href="#cb51-11" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb51-12"><a href="#cb51-12" tabindex="-1"></a><span class="co">#             National Cancer Institute Multivariate Method               #</span></span>
<span id="cb51-13"><a href="#cb51-13" tabindex="-1"></a><span class="co">#                                                                         #</span></span>
<span id="cb51-14"><a href="#cb51-14" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="do">##### 1) Winsorization #####</span></span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a><span class="co">#                 Winsorization                  #</span></span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a><span class="co"># ********************************************** #</span></span></code></pre></div>
<p>goal: identify extreme values and mitigate their impact using
Winsorization</p>
<p>note 1: in this example, only the UPPER values of intakes are
winsorized</p>
<p>note 2: to avoid repetitive code, every dietary constituent is looped
through the winsorization algorithm</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="co"># For comparison purpose, find the maximum value for each variable BEFORE winsorization</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>max_values_before <span class="ot">&lt;-</span> <span class="fu">apply</span>(preNCI[,<span class="fu">c</span>(vars_diet_all)], <span class="dv">2</span>, max)</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a><span class="co"># Step 1: initiate list</span></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>winsorize_x <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">&quot;list&quot;</span>, <span class="at">length=</span><span class="fu">length</span>(vars_diet_all))</span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a><span class="co"># Step 2: loop through all dietary constituents in &#39;vars_diet_all&#39;</span></span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(vars_diet_all)){</span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a></span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a>  <span class="co"># output current variable name for easier reading</span></span>
<span id="cb53-11"><a href="#cb53-11" tabindex="-1"></a>  current_x <span class="ot">&lt;-</span> vars_diet_all[i]</span>
<span id="cb53-12"><a href="#cb53-12" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" tabindex="-1"></a>  <span class="co"># 1) output a lower threshold to ignore winsorization of lower values</span></span>
<span id="cb53-14"><a href="#cb53-14" tabindex="-1"></a>  p5_nonzero_x <span class="ot">&lt;-</span></span>
<span id="cb53-15"><a href="#cb53-15" tabindex="-1"></a>    preNCI <span class="sc">|&gt;</span></span>
<span id="cb53-16"><a href="#cb53-16" tabindex="-1"></a>    <span class="fu">subset</span>(<span class="at">subset =</span> <span class="fu">get</span>(recall_id)<span class="sc">==</span><span class="dv">1</span> <span class="sc">&amp;</span> <span class="fu">get</span>(current_x)<span class="sc">&gt;</span><span class="dv">0</span>,</span>
<span id="cb53-17"><a href="#cb53-17" tabindex="-1"></a>           <span class="at">select =</span> <span class="fu">get</span>(current_x)) <span class="sc">|&gt;</span></span>
<span id="cb53-18"><a href="#cb53-18" tabindex="-1"></a>    stats<span class="sc">::</span><span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb53-19"><a href="#cb53-19" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" tabindex="-1"></a>  <span class="co"># note: 5th non zero percentile is arbitrary, does not matter as long as value is relatively low</span></span>
<span id="cb53-21"><a href="#cb53-21" tabindex="-1"></a></span>
<span id="cb53-22"><a href="#cb53-22" tabindex="-1"></a>  <span class="co"># 2) apply algorithm</span></span>
<span id="cb53-23"><a href="#cb53-23" tabindex="-1"></a>  winsorize <span class="ot">&lt;-</span></span>
<span id="cb53-24"><a href="#cb53-24" tabindex="-1"></a>    ncimultivar<span class="sc">::</span><span class="fu">boxcox_survey</span>(</span>
<span id="cb53-25"><a href="#cb53-25" tabindex="-1"></a>      <span class="at">input.data            =</span> preNCI ,</span>
<span id="cb53-26"><a href="#cb53-26" tabindex="-1"></a>      <span class="at">row.subset            =</span> preNCI[[recall_id]]<span class="sc">==</span><span class="dv">1</span>, <span class="co"># note: using first 24-h dietary recall to determine thresholds</span></span>
<span id="cb53-27"><a href="#cb53-27" tabindex="-1"></a>      <span class="at">id                    =</span> participant_id ,</span>
<span id="cb53-28"><a href="#cb53-28" tabindex="-1"></a>      <span class="at">repeat.obs            =</span> recall_id,</span>
<span id="cb53-29"><a href="#cb53-29" tabindex="-1"></a>      <span class="at">variable              =</span> current_x,</span>
<span id="cb53-30"><a href="#cb53-30" tabindex="-1"></a>      <span class="at">weight                =</span> wts_sample,</span>
<span id="cb53-31"><a href="#cb53-31" tabindex="-1"></a>      <span class="at">do.winsorization      =</span> <span class="cn">TRUE</span>,</span>
<span id="cb53-32"><a href="#cb53-32" tabindex="-1"></a>      <span class="at">is.episodic           =</span> current_x <span class="sc">%in%</span> vars_diet_episodic, <span class="co"># note: to assess non-zero values for episodic foods</span></span>
<span id="cb53-33"><a href="#cb53-33" tabindex="-1"></a>      <span class="at">iqr.multiple          =</span> <span class="dv">2</span> , <span class="co"># note: upper cut-off defined as: p75 + IQR * 2</span></span>
<span id="cb53-34"><a href="#cb53-34" tabindex="-1"></a>      <span class="at">print.winsorization   =</span> <span class="cn">FALSE</span>)</span>
<span id="cb53-35"><a href="#cb53-35" tabindex="-1"></a></span>
<span id="cb53-36"><a href="#cb53-36" tabindex="-1"></a>  <span class="co"># add generic names</span></span>
<span id="cb53-37"><a href="#cb53-37" tabindex="-1"></a>  <span class="fu">names</span>(<span class="fu">attributes</span>(winsorize)<span class="sc">$</span>winsorization.report) <span class="ot">&lt;-</span> <span class="fu">c</span>(participant_id, recall_id, <span class="st">&quot;original.value&quot;</span>, <span class="st">&quot;winsorized.value&quot;</span>)</span>
<span id="cb53-38"><a href="#cb53-38" tabindex="-1"></a></span>
<span id="cb53-39"><a href="#cb53-39" tabindex="-1"></a>  <span class="co"># 3) keep only the upper threshold, and ignore lower threshold</span></span>
<span id="cb53-40"><a href="#cb53-40" tabindex="-1"></a>  winsorize_x[[i]] <span class="ot">&lt;-</span></span>
<span id="cb53-41"><a href="#cb53-41" tabindex="-1"></a>    <span class="fu">attributes</span>(winsorize)<span class="sc">$</span>winsorization.report <span class="sc">|&gt;</span></span>
<span id="cb53-42"><a href="#cb53-42" tabindex="-1"></a>    <span class="co"># remove rows that were &#39;low outlier&#39; (i.e., winsorize only upper values)</span></span>
<span id="cb53-43"><a href="#cb53-43" tabindex="-1"></a>    <span class="fu">subset</span>(original.value <span class="sc">&gt;</span> p5_nonzero_x)</span>
<span id="cb53-44"><a href="#cb53-44" tabindex="-1"></a></span>
<span id="cb53-45"><a href="#cb53-45" tabindex="-1"></a>  <span class="fu">rm</span>(winsorize)</span>
<span id="cb53-46"><a href="#cb53-46" tabindex="-1"></a></span>
<span id="cb53-47"><a href="#cb53-47" tabindex="-1"></a>  <span class="co"># 4) Extract the upper threshold and winsorize accordingly</span></span>
<span id="cb53-48"><a href="#cb53-48" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">length</span>(winsorize_x[[i]]<span class="sc">$</span>winsorized.value)<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb53-49"><a href="#cb53-49" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Winsorization of x{i}, {current_x}: max. value {round(winsorize_x[[i]]$winsorized.value[1],2)}&quot;</span>))</span>
<span id="cb53-50"><a href="#cb53-50" tabindex="-1"></a></span>
<span id="cb53-51"><a href="#cb53-51" tabindex="-1"></a>    <span class="co"># if X&gt;x, let X be x, otherwise, no change</span></span>
<span id="cb53-52"><a href="#cb53-52" tabindex="-1"></a>    preNCI <span class="ot">&lt;-</span></span>
<span id="cb53-53"><a href="#cb53-53" tabindex="-1"></a>      preNCI <span class="sc">|&gt;</span></span>
<span id="cb53-54"><a href="#cb53-54" tabindex="-1"></a>      tidylog<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb53-55"><a href="#cb53-55" tabindex="-1"></a>        <span class="sc">!!</span><span class="fu">sym</span>(current_x) <span class="sc">:=</span> <span class="fu">pmin</span>(<span class="fu">get</span>(current_x), winsorize_x[[i]]<span class="sc">$</span>winsorized.value[<span class="dv">1</span>])</span>
<span id="cb53-56"><a href="#cb53-56" tabindex="-1"></a>      )</span>
<span id="cb53-57"><a href="#cb53-57" tabindex="-1"></a></span>
<span id="cb53-58"><a href="#cb53-58" tabindex="-1"></a>    <span class="co"># tidylog::mutate used here to have a summary of how many values were modified in the log</span></span>
<span id="cb53-59"><a href="#cb53-59" tabindex="-1"></a>    <span class="co"># alternative base R code: preNCI[[current_x]] &lt;- pmin(preNCI[[current_x]], winsorize_x[[i]]$winsorized.value[1])</span></span>
<span id="cb53-60"><a href="#cb53-60" tabindex="-1"></a></span>
<span id="cb53-61"><a href="#cb53-61" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb53-62"><a href="#cb53-62" tabindex="-1"></a>    <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Winsorization of x{i}, {current_x}: none.&quot;</span>))</span>
<span id="cb53-63"><a href="#cb53-63" tabindex="-1"></a></span>
<span id="cb53-64"><a href="#cb53-64" tabindex="-1"></a>  }</span>
<span id="cb53-65"><a href="#cb53-65" tabindex="-1"></a>  <span class="fu">rm</span>(current_x)</span>
<span id="cb53-66"><a href="#cb53-66" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Winsorization of x1, pfpb: max. value 17.7

## mutate: changed one value (&lt;1%) of &#39;pfpb&#39; (0 new NAs)
## Winsorization of x2, wg: max. value 10.31
## 
## mutate: changed 4 values (&lt;1%) of &#39;wg&#39; (0 new NAs)
## Winsorization of x3, milk: max. value 1479.95
## 
## mutate: changed 15 values (&lt;1%) of &#39;milk&#39; (0 new NAs)
## Winsorization of x4, otherbevs: none.
## 
## Winsorization of x5, water: max. value 4741.13
## 
## mutate: changed 9 values (&lt;1%) of &#39;water&#39; (0 new NAs)
## Winsorization of x6, pfab: max. value 16.42
## 
## mutate: changed 2 values (&lt;1%) of &#39;pfab&#39; (0 new NAs)
## Winsorization of x7, vf: max. value 14.69
## 
## mutate: changed 6 values (&lt;1%) of &#39;vf&#39; (0 new NAs)
## Winsorization of x8, rg: max. value 14.87
## 
## mutate: changed 7 values (&lt;1%) of &#39;rg&#39; (0 new NAs)
## Winsorization of x9, otherfoods: max. value 30.61
## 
## mutate: changed 7 values (&lt;1%) of &#39;otherfoods&#39; (0 new NAs)
## Winsorization of x10, freesugars: max. value 409.55
## 
## mutate: changed 5 values (&lt;1%) of &#39;freesugars&#39; (0 new NAs)
## Winsorization of x11, energy: max. value 7554.86
## 
## mutate: changed one value (&lt;1%) of &#39;energy&#39; (0 new NAs)
## Winsorization of x12, sfa: max. value 135.1
## 
## mutate: changed 3 values (&lt;1%) of &#39;sfa&#39; (0 new NAs)
## Winsorization of x13, mufa: max. value 139.93
## 
## mutate: changed one value (&lt;1%) of &#39;mufa&#39; (0 new NAs)
## Winsorization of x14, pufa: max. value 82.6
## 
## mutate: changed 4 values (&lt;1%) of &#39;pufa&#39; (0 new NAs)
## Winsorization of x15, sodium: max. value 11083.25
## 
## mutate: changed 5 values (&lt;1%) of &#39;sodium&#39; (0 new NAs)</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="co"># Step 3) Assessment. Find the maximum value for each variable AFTER winsorization</span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>max_values_after <span class="ot">&lt;-</span> <span class="fu">apply</span>(preNCI[,<span class="fu">c</span>(vars_diet_all)], <span class="dv">2</span>, max)</span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a><span class="co"># Compare max before and after</span></span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(max_values_before,<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##       pfpb         wg       milk  otherbevs      water       pfab         vf         rg otherfoods freesugars     energy 
##       38.5       19.0     3681.7     3862.0     8449.3       27.4       19.7       26.0      106.1      490.1    13650.7 
##        sfa       mufa       pufa     sodium 
##      195.8      232.7      166.0    20121.3</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(max_values_after,<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##       pfpb         wg       milk  otherbevs      water       pfab         vf         rg otherfoods freesugars     energy 
##       17.7       10.3     1479.9     3862.0     4741.1       16.4       14.7       14.9       30.6      409.6     7554.9 
##        sfa       mufa       pufa     sodium 
##      135.1      139.9       82.6    11083.3</code></pre>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">round</span>(max_values_before<span class="sc">-</span>max_values_after,<span class="dv">1</span>))</span></code></pre></div>
<pre><code>##       pfpb         wg       milk  otherbevs      water       pfab         vf         rg otherfoods freesugars     energy 
##       20.8        8.6     2201.7        0.0     3708.1       11.0        5.0       11.1       75.5       80.6     6095.8 
##        sfa       mufa       pufa     sodium 
##       60.7       92.7       83.4     9038.1</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="co"># Show report</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a><span class="do">## add variable names for clarity</span></span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a><span class="fu">names</span>(winsorize_x) <span class="ot">&lt;-</span> vars_diet_all</span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" tabindex="-1"></a><span class="fu">print</span>(winsorize_x)</span></code></pre></div>
<pre><code>## $pfpb
##     ADM_RNO SUPPID original.value winsorized.value
## 855    5700      1       38.48693         17.69991
## 
## $wg
##      ADM_RNO SUPPID original.value winsorized.value
## 417     2811      2       11.62549         10.31391
## 705     4846      1       13.24570         10.31391
## 1780   11964      1       18.96000         10.31391
## 2581   17330      1       11.68525         10.31391
## 
## $milk
##      ADM_RNO SUPPID original.value winsorized.value
## 145     1065      1       1642.367         1479.946
## 293     2013      2       1660.487         1479.946
## 335     2241      2       1853.921         1479.946
## 1499   10253      2       2044.183         1479.946
## 1646   11199      1       1835.949         1479.946
## 1786   11987      1       3182.280         1479.946
## 2267   15288      1       2800.552         1479.946
## 2297   15504      1       1480.028         1479.946
## 2339   15855      2       1505.669         1479.946
## 2402   16219      1       1608.797         1479.946
## 2406   16264      1       2082.088         1479.946
## 2409   16309      1       1546.920         1479.946
## 2613   17521      1       3681.670         1479.946
## 2726   18285      2       1631.180         1479.946
## 2770   18588      1       1660.675         1479.946
## 
## $otherbevs
## [1] ADM_RNO          SUPPID           original.value   winsorized.value
## &lt;0 rows&gt; (or 0-length row.names)
## 
## $water
##      ADM_RNO SUPPID original.value winsorized.value
## 49       406      1       5399.109          4741.13
## 216     1492      2       5609.464          4741.13
## 759     5200      1       8449.255          4741.13
## 2225   15021      1       5304.960          4741.13
## 2226   15021      2       5350.000          4741.13
## 2421   16375      1       4865.897          4741.13
## 2547   17131      1       5001.846          4741.13
## 2620   17540      1       7471.880          4741.13
## 2859   19195      2       4942.976          4741.13
## 
## $pfab
##      ADM_RNO SUPPID original.value winsorized.value
## 1632   11093      2       26.75446           16.416
## 2406   16264      1       27.39395           16.416
## 
## $vf
##      ADM_RNO SUPPID original.value winsorized.value
## 1153    7743      1       19.67194         14.69163
## 1242    8406      1       17.23896         14.69163
## 1703   11548      1       17.00026         14.69163
## 1704   11548      2       14.76795         14.69163
## 2048   13800      1       18.72834         14.69163
## 2358   15964      1       18.64194         14.69163
## 
## $rg
##      ADM_RNO SUPPID original.value winsorized.value
## 364     2449      1       24.77116          14.8681
## 702     4821      1       15.79288          14.8681
## 751     5162      1       25.96743          14.8681
## 1842   12343      1       14.92221          14.8681
## 2108   14207      2       24.18657          14.8681
## 2406   16264      1       18.77153          14.8681
## 2451   16550      1       14.91389          14.8681
## 
## $otherfoods
##      ADM_RNO SUPPID original.value winsorized.value
## 317     2130      2      106.09107         30.60694
## 494     3314      2       32.11460         30.60694
## 1177    7912      1       34.92231         30.60694
## 1427    9692      1       51.69343         30.60694
## 2423   16376      1       30.94132         30.60694
## 2637   17694      1       36.91078         30.60694
## 2730   18304      1       32.96600         30.60694
## 
## $freesugars
##      ADM_RNO SUPPID original.value winsorized.value
## 1079    7151      1       434.9420         409.5531
## 1151    7738      1       490.1364         409.5531
## 1278    8592      1       454.6627         409.5531
## 2423   16376      1       450.1654         409.5531
## 2637   17694      1       428.2215         409.5531
## 
## $energy
##      ADM_RNO SUPPID original.value winsorized.value
## 2406   16264      1       13650.69         7554.856
## 
## $sfa
##      ADM_RNO SUPPID original.value winsorized.value
## 629     4293      1       154.4698         135.0987
## 1632   11093      2       175.6266         135.0987
## 2406   16264      1       195.8208         135.0987
## 
## $mufa
##      ADM_RNO SUPPID original.value winsorized.value
## 2406   16264      1       232.6652         139.9298
## 
## $pufa
##      ADM_RNO SUPPID original.value winsorized.value
## 1231    8327      1      166.00344         82.59753
## 1478   10146      1      101.68289         82.59753
## 2406   16264      1      163.42451         82.59753
## 2828   18992      1       89.76662         82.59753
## 
## $sodium
##      ADM_RNO SUPPID original.value winsorized.value
## 102      742      1       11456.05         11083.25
## 364     2449      1       11517.69         11083.25
## 2406   16264      1       20121.31         11083.25
## 2556   17191      1       11248.22         11083.25
## 2860   19196      1       12267.68         11083.25</code></pre>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a><span class="do">##### 2) Box-Cox transformation #####</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a><span class="co">#             Box-Cox transformation             #</span></span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a><span class="co"># ********************************************** #</span></span></code></pre></div>
<p>goal: run Box-Cox survey with covariates to get transformation
parameter</p>
<p>note: to avoid repetitive code, every dietary constituent is looped
through Box-Cox survey</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="co"># Step 1: initiate list</span></span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>tran_lambda <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="at">mode=</span><span class="st">&quot;list&quot;</span>, <span class="at">length=</span><span class="fu">length</span>(vars_diet_all))</span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a><span class="co"># Step 2: apply &#39;boxcox_survey&#39;</span></span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(vars_diet_all)){</span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a>  <span class="co"># Box-Cox transformation</span></span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a>  boxcox <span class="ot">&lt;-</span></span>
<span id="cb64-9"><a href="#cb64-9" tabindex="-1"></a>    ncimultivar<span class="sc">::</span><span class="fu">boxcox_survey</span>(</span>
<span id="cb64-10"><a href="#cb64-10" tabindex="-1"></a>      <span class="at">input.data            =</span> preNCI,</span>
<span id="cb64-11"><a href="#cb64-11" tabindex="-1"></a>      <span class="at">row.subset            =</span> (preNCI[[recall_id]]<span class="sc">==</span><span class="dv">1</span>), <span class="co"># note: use first 24-h recall for transformation</span></span>
<span id="cb64-12"><a href="#cb64-12" tabindex="-1"></a>      <span class="at">variable              =</span> vars_diet_all[i],</span>
<span id="cb64-13"><a href="#cb64-13" tabindex="-1"></a>      <span class="at">covariates            =</span> vars_z,</span>
<span id="cb64-14"><a href="#cb64-14" tabindex="-1"></a>      <span class="at">weight                =</span> wts_sample,</span>
<span id="cb64-15"><a href="#cb64-15" tabindex="-1"></a>      <span class="at">is.episodic           =</span> vars_diet_all[i] <span class="sc">%in%</span> vars_diet_episodic <span class="co">#assess non-zero values for episodic foods</span></span>
<span id="cb64-16"><a href="#cb64-16" tabindex="-1"></a>    )</span>
<span id="cb64-17"><a href="#cb64-17" tabindex="-1"></a></span>
<span id="cb64-18"><a href="#cb64-18" tabindex="-1"></a>  <span class="fu">message</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;Box-Cox lambda of x{i}, {vars_diet_all[i]}: {boxcox$tran_lambda}&quot;</span>))</span>
<span id="cb64-19"><a href="#cb64-19" tabindex="-1"></a>  tran_lambda[[i]] <span class="ot">&lt;-</span> boxcox<span class="sc">$</span>tran_lambda</span>
<span id="cb64-20"><a href="#cb64-20" tabindex="-1"></a>  <span class="fu">rm</span>(boxcox)</span>
<span id="cb64-21"><a href="#cb64-21" tabindex="-1"></a></span>
<span id="cb64-22"><a href="#cb64-22" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Box-Cox lambda of x1, pfpb: 0.06

## Box-Cox lambda of x2, wg: 0.19

## Box-Cox lambda of x3, milk: 0.39

## Box-Cox lambda of x4, otherbevs: 0.07

## Box-Cox lambda of x5, water: 0.39

## Box-Cox lambda of x6, pfab: 0.22

## Box-Cox lambda of x7, vf: 0.41

## Box-Cox lambda of x8, rg: 0.33

## Box-Cox lambda of x9, otherfoods: 0.24

## Box-Cox lambda of x10, freesugars: 0.37

## Box-Cox lambda of x11, energy: 0.12

## Box-Cox lambda of x12, sfa: 0.18

## Box-Cox lambda of x13, mufa: 0.2

## Box-Cox lambda of x14, pufa: 0.12

## Box-Cox lambda of x15, sodium: 0.29</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="co"># Create a dataset with transformation parameter to use in preprocessor macro</span></span></code></pre></div>
<p>NCI note: the variable name must be in a column called
<code>variable</code> and the transformation parameter must be in a
column called <code>tran_lambda</code></p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>boxcox_lambda_x <span class="ot">&lt;-</span></span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>    <span class="at">variable =</span> vars_diet_all,</span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a>    <span class="at">tran_lambda =</span> <span class="fu">unlist</span>(tran_lambda)</span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a>  )</span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a></span>
<span id="cb67-7"><a href="#cb67-7" tabindex="-1"></a><span class="co"># Show values</span></span>
<span id="cb67-8"><a href="#cb67-8" tabindex="-1"></a><span class="fu">print</span>(boxcox_lambda_x)</span></code></pre></div>
<pre><code>##      variable tran_lambda
## 1        pfpb        0.06
## 2          wg        0.19
## 3        milk        0.39
## 4   otherbevs        0.07
## 5       water        0.39
## 6        pfab        0.22
## 7          vf        0.41
## 8          rg        0.33
## 9  otherfoods        0.24
## 10 freesugars        0.37
## 11     energy        0.12
## 12        sfa        0.18
## 13       mufa        0.20
## 14       pufa        0.12
## 15     sodium        0.29</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="do">##### 3) Minimum value #####</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a><span class="co">#                 Minimum value                  #</span></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>minimum_amount_x <span class="ot">&lt;-</span></span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>  ncimultivar<span class="sc">::</span><span class="fu">calculate_minimum_amount</span>(</span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a>    <span class="at">input.data         =</span> preNCI,</span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a>    <span class="at">episodic.variables =</span> vars_diet_episodic,</span>
<span id="cb69-10"><a href="#cb69-10" tabindex="-1"></a>    <span class="at">daily.variables    =</span> vars_diet_daily)</span>
<span id="cb69-11"><a href="#cb69-11" tabindex="-1"></a></span>
<span id="cb69-12"><a href="#cb69-12" tabindex="-1"></a><span class="co"># Show minimum values</span></span>
<span id="cb69-13"><a href="#cb69-13" tabindex="-1"></a><span class="fu">print</span>(minimum_amount_x)</span></code></pre></div>
<pre><code>##              variable     minamount
## pfpb             pfpb   0.005129795
## wg                 wg   0.004776275
## milk             milk   0.515000000
## otherbevs   otherbevs   0.695534500
## water           water   0.500845000
## pfab             pfab   0.004081045
## vf                 vf   0.001621135
## rg                 rg   0.005018683
## otherfoods otherfoods   0.022671545
## freesugars freesugars   0.007153146
## energy         energy 133.252370500
## sfa               sfa   0.128322000
## mufa             mufa   0.227410500
## pufa             pufa   0.320091500
## sodium         sodium  69.671218500</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a><span class="do">###### Save pre-processing data for reference ######</span></span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a><span class="co">#     Save pre-processing data for reference     #</span></span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a><span class="co"># ********************************************** #</span></span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" tabindex="-1"></a><span class="fu">save</span>(winsorize_x,boxcox_lambda_x, minimum_amount_x,</span>
<span id="cb71-7"><a href="#cb71-7" tabindex="-1"></a>     <span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_original,<span class="st">&quot;preprocess.rdata&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a><span class="do">##### Start bootstrap loop #####</span></span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a><span class="co"># ******************************************************** #</span></span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a><span class="co">#                   Start bootstrap loop                   #</span></span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a><span class="co"># ******************************************************** #</span></span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a><span class="co"># (manual) indicate number of replicate to run</span></span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a></span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>replicfirst <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a>repliclast  <span class="ot">&lt;-</span> <span class="dv">5</span></span></code></pre></div>
<p>note 1: to run only base estimates (original data) set both
‘replicfirst’ and ‘repliclast’ to <code>0</code></p>
<p>note 2: suggest to start with original sample first to validate
workflow, then, a few replicates (say 2 to 5), and only then, all 500
replicates.</p>
<p>note 3: in this example, all multivariate error models
<strong>and</strong> full simulation are saved. This provides maximal
flexibility to generate statistics of interest based on simulated data.
However, considerable disk space is required for both the model and
simulations. Saving all 500 bootstrap replicate would require
approximately 0.2 GB * 500 = 100 GB of disk space for this example.</p>
<p>note 4: a parallel computing approach is demonstrated below to reduce
analysis time. Alternatively, a standard for-loop approach could be used
using the code
<code>for (replicate.num in replicfirst:repliclast){...}</code></p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="co"># (auto) ensure required data and vectors are available</span></span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span>(<span class="fu">exists</span>(<span class="st">&quot;bsw&quot;</span>)) <span class="sc">|</span> <span class="sc">!</span>(<span class="fu">exists</span>(<span class="st">&quot;preNCI&quot;</span>))) <span class="fu">load</span>(<span class="fu">file.path</span>(dir_nci_original,<span class="st">&quot;preNCI_n_bsw.rdata&quot;</span>))</span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span>(<span class="fu">exists</span>(<span class="st">&quot;vars_diet_daily&quot;</span>)) <span class="sc">|</span> <span class="sc">!</span>(<span class="fu">exists</span>(<span class="st">&quot;vars_diet_episodic&quot;</span>))) <span class="fu">load</span>(<span class="fu">file.path</span>(dir_nci_original,<span class="st">&quot;predefined_vectors.rdata&quot;</span>))</span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span>(<span class="fu">exists</span>(<span class="st">&quot;boxcox_lambda_x&quot;</span>)) <span class="sc">|</span> <span class="sc">!</span>(<span class="fu">exists</span>(<span class="st">&quot;minimum_amount_x&quot;</span>))) <span class="fu">load</span>(<span class="fu">file.path</span>(dir_nci_original,<span class="st">&quot;preprocess.rdata&quot;</span>))</span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a><span class="fu">dim</span>(preNCI); <span class="fu">names</span>(preNCI)</span></code></pre></div>
<pre><code>## [1] 3044   23

##  [1] &quot;ADM_RNO&quot;      &quot;SUPPID&quot;       &quot;r24_weekend&quot;  &quot;r24_day2&quot;     &quot;drig_f_9_13&quot;  &quot;drig_m_14_18&quot; &quot;drig_f_14_18&quot;
##  [8] &quot;pfpb&quot;         &quot;wg&quot;           &quot;milk&quot;         &quot;otherbevs&quot;    &quot;water&quot;        &quot;pfab&quot;         &quot;vf&quot;          
## [15] &quot;rg&quot;           &quot;otherfoods&quot;   &quot;freesugars&quot;   &quot;energy&quot;       &quot;sfa&quot;          &quot;mufa&quot;         &quot;pufa&quot;        
## [22] &quot;sodium&quot;       &quot;BSW0&quot;</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="fu">dim</span>(bsw); <span class="fu">names</span>(bsw)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>## [1] 2026  502

##  [1] &quot;ADM_RNO&quot; &quot;BSW0&quot;    &quot;BSW1&quot;    &quot;BSW2&quot;    &quot;BSW3&quot;    &quot;BSW4&quot;    &quot;BSW5&quot;    &quot;BSW6&quot;    &quot;BSW7&quot;    &quot;BSW8&quot;</code></pre>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a><span class="co"># (auto) prepare parallel computing</span></span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(multisession, <span class="at">workers =</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()<span class="sc">-</span><span class="dv">2</span>)</span>
<span id="cb77-3"><a href="#cb77-3" tabindex="-1"></a>doFuture<span class="sc">::</span><span class="fu">registerDoFuture</span>()</span>
<span id="cb77-4"><a href="#cb77-4" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">nbrOfWorkers</span>()</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a><span class="co"># (auto) log time required to complete</span></span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;NCI MCMC (model+sim.; {length(vars_diet_all)} components incl. {length(vars_diet_episodic)} episodic), replicate {replicfirst} to {repliclast}&quot;</span>))</span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" tabindex="-1"></a><span class="co"># (auto) lunch parallel bootstrap loop, ensure all information available</span></span>
<span id="cb79-5"><a href="#cb79-5" tabindex="-1"></a>foreach<span class="sc">::</span><span class="fu">foreach</span>(<span class="at">replicate.num =</span> replicfirst<span class="sc">:</span>repliclast,</span>
<span id="cb79-6"><a href="#cb79-6" tabindex="-1"></a>                 <span class="at">.export =</span> <span class="fu">c</span>(<span class="st">&quot;dir_nci_original&quot;</span>, <span class="st">&quot;dir_nci_bootstrap&quot;</span>,</span>
<span id="cb79-7"><a href="#cb79-7" tabindex="-1"></a>                             <span class="st">&quot;participant_id&quot;</span>, <span class="st">&quot;recall_id&quot;</span>,</span>
<span id="cb79-8"><a href="#cb79-8" tabindex="-1"></a>                             <span class="st">&quot;vars_diet_all&quot;</span>, <span class="st">&quot;vars_diet_daily&quot;</span>, <span class="st">&quot;vars_diet_episodic&quot;</span>, <span class="st">&quot;vars_z&quot;</span>,</span>
<span id="cb79-9"><a href="#cb79-9" tabindex="-1"></a>                             <span class="st">&quot;preNCI&quot;</span>, <span class="st">&quot;bsw&quot;</span>, <span class="st">&quot;boxcox_lambda_x&quot;</span>, <span class="st">&quot;minimum_amount_x&quot;</span>),</span>
<span id="cb79-10"><a href="#cb79-10" tabindex="-1"></a>                 <span class="at">.packages =</span> <span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;tidylog&quot;</span>, <span class="st">&quot;ncimultivar&quot;</span>)</span>
<span id="cb79-11"><a href="#cb79-11" tabindex="-1"></a>) <span class="sc">%dopar%</span> {</span>
<span id="cb79-12"><a href="#cb79-12" tabindex="-1"></a></span>
<span id="cb79-13"><a href="#cb79-13" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;Starting Iteration &quot;</span>, replicate.num))</span>
<span id="cb79-14"><a href="#cb79-14" tabindex="-1"></a></span>
<span id="cb79-15"><a href="#cb79-15" tabindex="-1"></a>  <span class="co">#&#39;</span></span>
<span id="cb79-16"><a href="#cb79-16" tabindex="-1"></a>  <span class="do">##### 4) Merge preNCI with BSW #####</span></span>
<span id="cb79-17"><a href="#cb79-17" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-18"><a href="#cb79-18" tabindex="-1"></a>  <span class="co">#            4) Merge preNCI with BSW            #</span></span>
<span id="cb79-19"><a href="#cb79-19" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-20"><a href="#cb79-20" tabindex="-1"></a></span>
<span id="cb79-21"><a href="#cb79-21" tabindex="-1"></a>  preNCI_with_bsw <span class="ot">&lt;-</span></span>
<span id="cb79-22"><a href="#cb79-22" tabindex="-1"></a>    preNCI <span class="sc">|&gt;</span></span>
<span id="cb79-23"><a href="#cb79-23" tabindex="-1"></a>    <span class="fu">inner_join</span>(</span>
<span id="cb79-24"><a href="#cb79-24" tabindex="-1"></a>      <span class="fu">subset</span>(bsw, <span class="at">select =</span> <span class="fu">c</span>(<span class="fu">get</span>(participant_id), <span class="fu">get</span>(<span class="fu">paste0</span>(<span class="st">&quot;BSW&quot;</span>, replicate.num))))</span>
<span id="cb79-25"><a href="#cb79-25" tabindex="-1"></a>    )</span>
<span id="cb79-26"><a href="#cb79-26" tabindex="-1"></a></span>
<span id="cb79-27"><a href="#cb79-27" tabindex="-1"></a>  <span class="co"># note: all should be &#39;matched rows&#39;, or only rows from &#39;preNCI&#39; if the full bsw data is used.</span></span>
<span id="cb79-28"><a href="#cb79-28" tabindex="-1"></a></span>
<span id="cb79-29"><a href="#cb79-29" tabindex="-1"></a>  <span class="co">#&#39;</span></span>
<span id="cb79-30"><a href="#cb79-30" tabindex="-1"></a>  <span class="do">##### 5) Pre-processing: &#39;nci_multivar_preprocessor&#39; #####</span></span>
<span id="cb79-31"><a href="#cb79-31" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-32"><a href="#cb79-32" tabindex="-1"></a>  <span class="co">#  Pre-processing: &#39;nci_multivar_preprocessor&#39;   #</span></span>
<span id="cb79-33"><a href="#cb79-33" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-34"><a href="#cb79-34" tabindex="-1"></a></span>
<span id="cb79-35"><a href="#cb79-35" tabindex="-1"></a>  pre_mcmc_data <span class="ot">&lt;-</span></span>
<span id="cb79-36"><a href="#cb79-36" tabindex="-1"></a>    ncimultivar<span class="sc">::</span><span class="fu">nci_multivar_preprocessor</span>(</span>
<span id="cb79-37"><a href="#cb79-37" tabindex="-1"></a>      <span class="at">input.data         =</span> preNCI_with_bsw,</span>
<span id="cb79-38"><a href="#cb79-38" tabindex="-1"></a>      <span class="at">daily.variables    =</span> vars_diet_daily,</span>
<span id="cb79-39"><a href="#cb79-39" tabindex="-1"></a>      <span class="at">episodic.variables =</span> vars_diet_episodic,</span>
<span id="cb79-40"><a href="#cb79-40" tabindex="-1"></a>      <span class="at">boxcox.lambda.data  =</span> boxcox_lambda_x,</span>
<span id="cb79-41"><a href="#cb79-41" tabindex="-1"></a>      <span class="at">minimum.amount.data =</span> minimum_amount_x)</span>
<span id="cb79-42"><a href="#cb79-42" tabindex="-1"></a></span>
<span id="cb79-43"><a href="#cb79-43" tabindex="-1"></a>  <span class="co"># overview</span></span>
<span id="cb79-44"><a href="#cb79-44" tabindex="-1"></a>  <span class="cf">if</span>(replicate.num<span class="sc">==</span><span class="dv">0</span>) <span class="fu">print</span>(pre_mcmc_data<span class="sc">$</span>backtransformation)</span>
<span id="cb79-45"><a href="#cb79-45" tabindex="-1"></a></span>
<span id="cb79-46"><a href="#cb79-46" tabindex="-1"></a></span>
<span id="cb79-47"><a href="#cb79-47" tabindex="-1"></a>  <span class="do">##### 6) MCMC error model: &#39;nci_multivar_mcmc&#39; #####</span></span>
<span id="cb79-48"><a href="#cb79-48" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-49"><a href="#cb79-49" tabindex="-1"></a>  <span class="co">#     MCMC error model: &#39;nci_multivar_mcmc&#39;      #</span></span>
<span id="cb79-50"><a href="#cb79-50" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-51"><a href="#cb79-51" tabindex="-1"></a></span>
<span id="cb79-52"><a href="#cb79-52" tabindex="-1"></a>  mcmc_model <span class="ot">&lt;-</span></span>
<span id="cb79-53"><a href="#cb79-53" tabindex="-1"></a>    ncimultivar<span class="sc">::</span><span class="fu">nci_multivar_mcmc</span>(</span>
<span id="cb79-54"><a href="#cb79-54" tabindex="-1"></a>      <span class="at">pre.mcmc.data          =</span> pre_mcmc_data,</span>
<span id="cb79-55"><a href="#cb79-55" tabindex="-1"></a>      <span class="at">id                     =</span> participant_id ,</span>
<span id="cb79-56"><a href="#cb79-56" tabindex="-1"></a>      <span class="at">repeat.obs             =</span> recall_id,</span>
<span id="cb79-57"><a href="#cb79-57" tabindex="-1"></a>      <span class="at">weight                 =</span> <span class="fu">paste0</span>(<span class="st">&quot;BSW&quot;</span>, replicate.num),</span>
<span id="cb79-58"><a href="#cb79-58" tabindex="-1"></a>      <span class="at">daily.variables        =</span> vars_diet_daily,</span>
<span id="cb79-59"><a href="#cb79-59" tabindex="-1"></a>      <span class="at">episodic.variables     =</span> vars_diet_episodic,</span>
<span id="cb79-60"><a href="#cb79-60" tabindex="-1"></a>      <span class="at">default.covariate      =</span> vars_z,</span>
<span id="cb79-61"><a href="#cb79-61" tabindex="-1"></a>      <span class="at">num.mcmc.iterations    =</span> <span class="dv">7000</span>,</span>
<span id="cb79-62"><a href="#cb79-62" tabindex="-1"></a>      <span class="at">num.burn               =</span> <span class="dv">4000</span>,</span>
<span id="cb79-63"><a href="#cb79-63" tabindex="-1"></a>      <span class="at">num.thin               =</span> <span class="dv">6</span>, <span class="co"># note: (7000-3000)/6 = 500 iterations used to calculate posterior means</span></span>
<span id="cb79-64"><a href="#cb79-64" tabindex="-1"></a>      <span class="at">mcmc.seed              =</span> <span class="dv">7625</span><span class="sc">+</span>replicate.num)</span>
<span id="cb79-65"><a href="#cb79-65" tabindex="-1"></a></span>
<span id="cb79-66"><a href="#cb79-66" tabindex="-1"></a>  <span class="co"># Starting seed from https://www.random.org</span></span>
<span id="cb79-67"><a href="#cb79-67" tabindex="-1"></a>  <span class="co"># 7625</span></span>
<span id="cb79-68"><a href="#cb79-68" tabindex="-1"></a>  <span class="co"># Min: 1, Max: 10000</span></span>
<span id="cb79-69"><a href="#cb79-69" tabindex="-1"></a>  <span class="co"># 2025-05-22 19:40:55 UTC</span></span>
<span id="cb79-70"><a href="#cb79-70" tabindex="-1"></a></span>
<span id="cb79-71"><a href="#cb79-71" tabindex="-1"></a>  <span class="co"># Save output data given base/original sample or bootstrap sample</span></span>
<span id="cb79-72"><a href="#cb79-72" tabindex="-1"></a>  <span class="cf">if</span>(replicate.num <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb79-73"><a href="#cb79-73" tabindex="-1"></a></span>
<span id="cb79-74"><a href="#cb79-74" tabindex="-1"></a>    <span class="fu">save</span>(mcmc_model, <span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_original, <span class="fu">paste0</span>(<span class="st">&quot;mcmc_model&quot;</span>,replicate.num,<span class="st">&quot;.rdata&quot;</span>)))</span>
<span id="cb79-75"><a href="#cb79-75" tabindex="-1"></a></span>
<span id="cb79-76"><a href="#cb79-76" tabindex="-1"></a>    mcmc_base <span class="ot">&lt;-</span> mcmc_model</span>
<span id="cb79-77"><a href="#cb79-77" tabindex="-1"></a></span>
<span id="cb79-78"><a href="#cb79-78" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb79-79"><a href="#cb79-79" tabindex="-1"></a></span>
<span id="cb79-80"><a href="#cb79-80" tabindex="-1"></a>    <span class="fu">save</span>(mcmc_model, <span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_bootstrap, <span class="fu">paste0</span>(<span class="st">&quot;mcmc_model&quot;</span>,replicate.num,<span class="st">&quot;.rdata&quot;</span>)))</span>
<span id="cb79-81"><a href="#cb79-81" tabindex="-1"></a>    mcmc_boot <span class="ot">&lt;-</span> mcmc_model</span>
<span id="cb79-82"><a href="#cb79-82" tabindex="-1"></a></span>
<span id="cb79-83"><a href="#cb79-83" tabindex="-1"></a>    <span class="co"># clean temporary</span></span>
<span id="cb79-84"><a href="#cb79-84" tabindex="-1"></a>    <span class="fu">rm</span>(mcmc_model)</span>
<span id="cb79-85"><a href="#cb79-85" tabindex="-1"></a></span>
<span id="cb79-86"><a href="#cb79-86" tabindex="-1"></a>  } <span class="co"># end of conditional on replicate number</span></span>
<span id="cb79-87"><a href="#cb79-87" tabindex="-1"></a></span>
<span id="cb79-88"><a href="#cb79-88" tabindex="-1"></a>  <span class="co">#&#39; note: it would be more efficient to store all bootstrap models in a common list,</span></span>
<span id="cb79-89"><a href="#cb79-89" tabindex="-1"></a>  <span class="co">#&#39; but it is more flexible to save separate object in case of disk space issues, failed run, etc.</span></span>
<span id="cb79-90"><a href="#cb79-90" tabindex="-1"></a></span>
<span id="cb79-91"><a href="#cb79-91" tabindex="-1"></a>  <span class="co">#&#39;</span></span>
<span id="cb79-92"><a href="#cb79-92" tabindex="-1"></a>  <span class="do">##### 7) Create population base for distrib #####</span></span>
<span id="cb79-93"><a href="#cb79-93" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-94"><a href="#cb79-94" tabindex="-1"></a>  <span class="co">#       Create population base for distrib       #</span></span>
<span id="cb79-95"><a href="#cb79-95" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-96"><a href="#cb79-96" tabindex="-1"></a></span>
<span id="cb79-97"><a href="#cb79-97" tabindex="-1"></a>  <span class="co"># objective: create &quot;weighted&quot; data according to proportion of weekend/weekday, remove sequence effect</span></span>
<span id="cb79-98"><a href="#cb79-98" tabindex="-1"></a>  <span class="fu">dim</span>(pre_mcmc_data<span class="sc">$</span>mcmc.input); <span class="fu">names</span>(pre_mcmc_data<span class="sc">$</span>mcmc.input)</span>
<span id="cb79-99"><a href="#cb79-99" tabindex="-1"></a></span>
<span id="cb79-100"><a href="#cb79-100" tabindex="-1"></a>  <span class="co">#&#39; note: variable names are hardcoded for sequence=`r24_day2` and weekend=`r24_weekend`. Update in different setting.</span></span>
<span id="cb79-101"><a href="#cb79-101" tabindex="-1"></a></span>
<span id="cb79-102"><a href="#cb79-102" tabindex="-1"></a>  <span class="co"># output unique row for each respondent</span></span>
<span id="cb79-103"><a href="#cb79-103" tabindex="-1"></a>  input_1row <span class="ot">&lt;-</span></span>
<span id="cb79-104"><a href="#cb79-104" tabindex="-1"></a>    pre_mcmc_data<span class="sc">$</span>mcmc.input <span class="sc">|&gt;</span></span>
<span id="cb79-105"><a href="#cb79-105" tabindex="-1"></a>    <span class="fu">distinct</span>(.data[[participant_id]],<span class="at">.keep_all=</span><span class="cn">TRUE</span>)</span>
<span id="cb79-106"><a href="#cb79-106" tabindex="-1"></a></span>
<span id="cb79-107"><a href="#cb79-107" tabindex="-1"></a>  num_subjects <span class="ot">&lt;-</span> <span class="fu">nrow</span>(input_1row)</span>
<span id="cb79-108"><a href="#cb79-108" tabindex="-1"></a></span>
<span id="cb79-109"><a href="#cb79-109" tabindex="-1"></a>  <span class="co"># cancel effect of recall day 2</span></span>
<span id="cb79-110"><a href="#cb79-110" tabindex="-1"></a>  input_1row<span class="sc">$</span>r24_day2 <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb79-111"><a href="#cb79-111" tabindex="-1"></a></span>
<span id="cb79-112"><a href="#cb79-112" tabindex="-1"></a>  <span class="co"># create repeats of each participant for weekday and weekend consumption</span></span>
<span id="cb79-113"><a href="#cb79-113" tabindex="-1"></a></span>
<span id="cb79-114"><a href="#cb79-114" tabindex="-1"></a>  <span class="do">## replicate each row of the data twice (for weekday/weekend)</span></span>
<span id="cb79-115"><a href="#cb79-115" tabindex="-1"></a>  distrib_pop <span class="ot">&lt;-</span> input_1row[<span class="fu">rep</span>(<span class="fu">seq_len</span>(num_subjects), <span class="at">each=</span><span class="dv">2</span>),]</span>
<span id="cb79-116"><a href="#cb79-116" tabindex="-1"></a></span>
<span id="cb79-117"><a href="#cb79-117" tabindex="-1"></a>  <span class="do">## assign value of 0/1 for the weekend indicator</span></span>
<span id="cb79-118"><a href="#cb79-118" tabindex="-1"></a>  distrib_pop<span class="sc">$</span>r24_weekend <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), num_subjects)</span>
<span id="cb79-119"><a href="#cb79-119" tabindex="-1"></a></span>
<span id="cb79-120"><a href="#cb79-120" tabindex="-1"></a>  <span class="do">## assign weight to each row (&#39;4&#39; for weekend=0, &#39;3&#39; for weekend=1; i.e., Mon-Thur, Fri-Sun respectively)</span></span>
<span id="cb79-121"><a href="#cb79-121" tabindex="-1"></a>  distrib_pop<span class="sc">$</span>weekend_weight <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>), num_subjects)</span>
<span id="cb79-122"><a href="#cb79-122" tabindex="-1"></a></span>
<span id="cb79-123"><a href="#cb79-123" tabindex="-1"></a>  <span class="co">#&#39;</span></span>
<span id="cb79-124"><a href="#cb79-124" tabindex="-1"></a>  <span class="do">##### 8) MCMC simulation: &#39;nci_multivar_distrib&#39; #####</span></span>
<span id="cb79-125"><a href="#cb79-125" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-126"><a href="#cb79-126" tabindex="-1"></a>  <span class="co">#    MCMC simulation: &#39;nci_multivar_distrib&#39;     #</span></span>
<span id="cb79-127"><a href="#cb79-127" tabindex="-1"></a>  <span class="co"># ********************************************** #</span></span>
<span id="cb79-128"><a href="#cb79-128" tabindex="-1"></a></span>
<span id="cb79-129"><a href="#cb79-129" tabindex="-1"></a>  <span class="co"># Indicate input data according to base/original sample or bootstrap sample</span></span>
<span id="cb79-130"><a href="#cb79-130" tabindex="-1"></a>  mcmc_data <span class="ot">&lt;-</span> <span class="cf">if</span> (replicate.num <span class="sc">==</span> <span class="dv">0</span>) mcmc_base <span class="cf">else</span> mcmc_boot</span>
<span id="cb79-131"><a href="#cb79-131" tabindex="-1"></a></span>
<span id="cb79-132"><a href="#cb79-132" tabindex="-1"></a>  <span class="co"># Simulate &#39;usual intake&#39; data frame with 500 simulations for each respondent</span></span>
<span id="cb79-133"><a href="#cb79-133" tabindex="-1"></a></span>
<span id="cb79-134"><a href="#cb79-134" tabindex="-1"></a>  mcmc_sim <span class="ot">&lt;-</span></span>
<span id="cb79-135"><a href="#cb79-135" tabindex="-1"></a>    ncimultivar<span class="sc">::</span><span class="fu">nci_multivar_distrib</span>(</span>
<span id="cb79-136"><a href="#cb79-136" tabindex="-1"></a>      <span class="at">multivar.mcmc.model  =</span> mcmc_data,</span>
<span id="cb79-137"><a href="#cb79-137" tabindex="-1"></a>      <span class="at">distrib.population   =</span> distrib_pop,</span>
<span id="cb79-138"><a href="#cb79-138" tabindex="-1"></a>      <span class="at">id                   =</span> participant_id ,</span>
<span id="cb79-139"><a href="#cb79-139" tabindex="-1"></a>      <span class="at">weight               =</span> <span class="fu">paste0</span>(<span class="st">&quot;BSW&quot;</span>, replicate.num),</span>
<span id="cb79-140"><a href="#cb79-140" tabindex="-1"></a>      <span class="at">nuisance.weight      =</span> <span class="st">&quot;weekend_weight&quot;</span>, <span class="co"># note: name defined in step 7 above</span></span>
<span id="cb79-141"><a href="#cb79-141" tabindex="-1"></a>      <span class="at">additional.output    =</span> vars_z[<span class="dv">3</span><span class="sc">:</span><span class="fu">length</span>(vars_z)], <span class="co"># note: hardcoded exclusion of first 2 variables which were nuisance (weekend, seq)</span></span>
<span id="cb79-142"><a href="#cb79-142" tabindex="-1"></a>      <span class="at">num.simulated.u      =</span> <span class="dv">500</span>,</span>
<span id="cb79-143"><a href="#cb79-143" tabindex="-1"></a>      <span class="at">distrib.seed         =</span> <span class="dv">9666</span><span class="sc">+</span>replicate.num)</span>
<span id="cb79-144"><a href="#cb79-144" tabindex="-1"></a></span>
<span id="cb79-145"><a href="#cb79-145" tabindex="-1"></a>  <span class="co"># Starting seed from https://www.random.org</span></span>
<span id="cb79-146"><a href="#cb79-146" tabindex="-1"></a>  <span class="co"># 9666</span></span>
<span id="cb79-147"><a href="#cb79-147" tabindex="-1"></a>  <span class="co"># Min: 1, Max: 10000</span></span>
<span id="cb79-148"><a href="#cb79-148" tabindex="-1"></a>  <span class="co"># 2025-05-22 19:41:29 UTC</span></span>
<span id="cb79-149"><a href="#cb79-149" tabindex="-1"></a></span>
<span id="cb79-150"><a href="#cb79-150" tabindex="-1"></a>  <span class="co"># Save simulation data given base/original sample or bootstrap sample</span></span>
<span id="cb79-151"><a href="#cb79-151" tabindex="-1"></a>  <span class="cf">if</span>(replicate.num <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb79-152"><a href="#cb79-152" tabindex="-1"></a></span>
<span id="cb79-153"><a href="#cb79-153" tabindex="-1"></a>    <span class="fu">save</span>(mcmc_sim, <span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_original, <span class="fu">paste0</span>(<span class="st">&quot;mcmc_sim&quot;</span>,replicate.num,<span class="st">&quot;.rdata&quot;</span>)))</span>
<span id="cb79-154"><a href="#cb79-154" tabindex="-1"></a></span>
<span id="cb79-155"><a href="#cb79-155" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb79-156"><a href="#cb79-156" tabindex="-1"></a></span>
<span id="cb79-157"><a href="#cb79-157" tabindex="-1"></a>    <span class="fu">save</span>(mcmc_sim, <span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_bootstrap, <span class="fu">paste0</span>(<span class="st">&quot;mcmc_sim&quot;</span>,replicate.num,<span class="st">&quot;.rdata&quot;</span>)))</span>
<span id="cb79-158"><a href="#cb79-158" tabindex="-1"></a></span>
<span id="cb79-159"><a href="#cb79-159" tabindex="-1"></a>  } <span class="co"># end of conditional on replicate number</span></span>
<span id="cb79-160"><a href="#cb79-160" tabindex="-1"></a></span>
<span id="cb79-161"><a href="#cb79-161" tabindex="-1"></a>  <span class="co">#&#39; note: it would be more efficient to store all bootstrap simulations in a common list,</span></span>
<span id="cb79-162"><a href="#cb79-162" tabindex="-1"></a>  <span class="co">#&#39; but it is more flexible to save separate object in case of disk space issues, failed run, etc.</span></span>
<span id="cb79-163"><a href="#cb79-163" tabindex="-1"></a></span>
<span id="cb79-164"><a href="#cb79-164" tabindex="-1"></a>} <span class="co"># end of parallel bootstrap loop</span></span></code></pre></div>
<pre><code>## [1] &quot;Starting Iteration 0&quot;
##      variable tran_lambda    minamount tran_center tran_scale biomarker
## 1      energy        0.12 1.332524e+02  12.1626520  0.7850041     FALSE
## 2  freesugars        0.37 7.153146e-03   9.6729096  2.7925495     FALSE
## 3        milk        0.39 5.150000e-01  20.0250198  5.7278405     FALSE
## 4        mufa        0.20 2.274105e-01   4.3577111  0.8235826     FALSE
## 5   otherbevs        0.07 6.955345e-01   7.6791139  0.8040011     FALSE
## 6  otherfoods        0.24 2.267155e-02   1.1758101  1.0443373     FALSE
## 7        pfab        0.22 4.081045e-03   0.4969870  0.9154161     FALSE
## 8        pfpb        0.06 5.129795e-03   0.1138360  0.7470796     FALSE
## 9        pufa        0.12 3.200915e-01   2.9126547  0.6343207     FALSE
## 10         rg        0.33 5.018683e-03   0.7452979  0.8749363     FALSE
## 11        sfa        0.18 1.283220e-01   4.0961616  0.7825729     FALSE
## 12     sodium        0.29 6.967122e+01  30.1993985  3.7263904     FALSE
## 13         vf        0.41 1.621135e-03   0.7876292  0.9495266     FALSE
## 14      water        0.39 5.008450e-01  29.5276147  9.8946673     FALSE
## 15         wg        0.19 4.776275e-03   0.2810858  0.5834197     FALSE

## Joining with `by = join_by(ADM_RNO, BSW0)`

## Warning: UNRELIABLE VALUE: One of the foreach() iterations (&#39;doFuture-1&#39;) unexpectedly generated random numbers without
## declaring so. There is a risk that those random numbers are not statistically sound and the overall results might be
## invalid. To fix this, use &#39;%dorng%&#39; from the &#39;doRNG&#39; package instead of &#39;%dopar%&#39;. This ensures that proper, parallel-safe
## random numbers are produced via the L&#39;Ecuyer-CMRG method. To disable this check, set option &#39;doFuture.rng.onMisuse&#39; to
## &quot;ignore&quot;.

## [1] &quot;Starting Iteration 1&quot;

## Joining with `by = join_by(ADM_RNO)`

## Warning: UNRELIABLE VALUE: One of the foreach() iterations (&#39;doFuture-2&#39;) unexpectedly generated random numbers without
## declaring so. There is a risk that those random numbers are not statistically sound and the overall results might be
## invalid. To fix this, use &#39;%dorng%&#39; from the &#39;doRNG&#39; package instead of &#39;%dopar%&#39;. This ensures that proper, parallel-safe
## random numbers are produced via the L&#39;Ecuyer-CMRG method. To disable this check, set option &#39;doFuture.rng.onMisuse&#39; to
## &quot;ignore&quot;.

## [1] &quot;Starting Iteration 2&quot;

## Joining with `by = join_by(ADM_RNO)`

## Warning: UNRELIABLE VALUE: One of the foreach() iterations (&#39;doFuture-3&#39;) unexpectedly generated random numbers without
## declaring so. There is a risk that those random numbers are not statistically sound and the overall results might be
## invalid. To fix this, use &#39;%dorng%&#39; from the &#39;doRNG&#39; package instead of &#39;%dopar%&#39;. This ensures that proper, parallel-safe
## random numbers are produced via the L&#39;Ecuyer-CMRG method. To disable this check, set option &#39;doFuture.rng.onMisuse&#39; to
## &quot;ignore&quot;.

## [1] &quot;Starting Iteration 3&quot;

## Joining with `by = join_by(ADM_RNO)`

## Warning: UNRELIABLE VALUE: One of the foreach() iterations (&#39;doFuture-4&#39;) unexpectedly generated random numbers without
## declaring so. There is a risk that those random numbers are not statistically sound and the overall results might be
## invalid. To fix this, use &#39;%dorng%&#39; from the &#39;doRNG&#39; package instead of &#39;%dopar%&#39;. This ensures that proper, parallel-safe
## random numbers are produced via the L&#39;Ecuyer-CMRG method. To disable this check, set option &#39;doFuture.rng.onMisuse&#39; to
## &quot;ignore&quot;.

## [1] &quot;Starting Iteration 4&quot;

## Joining with `by = join_by(ADM_RNO)`

## Warning: UNRELIABLE VALUE: One of the foreach() iterations (&#39;doFuture-5&#39;) unexpectedly generated random numbers without
## declaring so. There is a risk that those random numbers are not statistically sound and the overall results might be
## invalid. To fix this, use &#39;%dorng%&#39; from the &#39;doRNG&#39; package instead of &#39;%dopar%&#39;. This ensures that proper, parallel-safe
## random numbers are produced via the L&#39;Ecuyer-CMRG method. To disable this check, set option &#39;doFuture.rng.onMisuse&#39; to
## &quot;ignore&quot;.

## [1] &quot;Starting Iteration 5&quot;

## Joining with `by = join_by(ADM_RNO)`

## Warning: UNRELIABLE VALUE: One of the foreach() iterations (&#39;doFuture-6&#39;) unexpectedly generated random numbers without
## declaring so. There is a risk that those random numbers are not statistically sound and the overall results might be
## invalid. To fix this, use &#39;%dorng%&#39; from the &#39;doRNG&#39; package instead of &#39;%dopar%&#39;. This ensures that proper, parallel-safe
## random numbers are produced via the L&#39;Ecuyer-CMRG method. To disable this check, set option &#39;doFuture.rng.onMisuse&#39; to
## &quot;ignore&quot;.

## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL
## 
## [[5]]
## NULL
## 
## [[6]]
## NULL</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>() <span class="co"># time out</span></span></code></pre></div>
<pre><code>## NCI MCMC (model+sim.; 15 components incl. 4 episodic), replicate 0 to 5: 1456.362 sec elapsed</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="do">##### End bootstrap loop #####</span></span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a><span class="co"># ******************************************************** #</span></span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a><span class="co">#                                                          #</span></span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a><span class="co">#                                                          #</span></span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a><span class="co">#                    End bootstrap loop                    #</span></span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a><span class="co">#                                                          #</span></span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a><span class="co">#                                                          #</span></span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a><span class="co"># ******************************************************** #</span></span></code></pre></div>
<p>Multivar MCMC model assessment</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a><span class="do">#### Multivar MCMC model assessment ####</span></span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb84-3"><a href="#cb84-3" tabindex="-1"></a><span class="co">#                     Multivar MCMC model assessment                      #</span></span>
<span id="cb84-4"><a href="#cb84-4" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span></code></pre></div>
<p>note: see <em>Trace Plots for NCI Multivar MCMC</em> using
<code>browseVignettes(&quot;ncimultivar&quot;)</code> for details.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a><span class="co"># Helper function to generate and save PDF file of trace plot</span></span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a>make_trace_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(dir, multivar.mcmc.model, replicate.num){</span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>  <span class="fu">pdf</span>(<span class="at">file =</span> <span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(<span class="st">&quot;traceplot_&quot;</span>,replicate.num,<span class="st">&quot;.pdf&quot;</span>)))</span>
<span id="cb85-4"><a href="#cb85-4" tabindex="-1"></a>  ncimultivar<span class="sc">::</span><span class="fu">trace_plots</span>( <span class="at">multivar.mcmc.model  =</span> mcmc_model)</span>
<span id="cb85-5"><a href="#cb85-5" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb85-6"><a href="#cb85-6" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">file.exists</span>(<span class="fu">file.path</span>(dir, <span class="fu">paste0</span>(<span class="st">&quot;traceplot_&quot;</span>,replicate.num,<span class="st">&quot;.pdf&quot;</span>)))) {</span>
<span id="cb85-7"><a href="#cb85-7" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Trace plots created&quot;</span>)</span>
<span id="cb85-8"><a href="#cb85-8" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb85-9"><a href="#cb85-9" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Error: trace plots were NOT created&quot;</span>)</span>
<span id="cb85-10"><a href="#cb85-10" tabindex="-1"></a>  }</span>
<span id="cb85-11"><a href="#cb85-11" tabindex="-1"></a>}</span>
<span id="cb85-12"><a href="#cb85-12" tabindex="-1"></a></span>
<span id="cb85-13"><a href="#cb85-13" tabindex="-1"></a><span class="co"># Load original sample model</span></span>
<span id="cb85-14"><a href="#cb85-14" tabindex="-1"></a><span class="fu">load</span>(<span class="at">file =</span> <span class="fu">file.path</span>(dir_nci_original, <span class="st">&quot;mcmc_model0.rdata&quot;</span>))</span>
<span id="cb85-15"><a href="#cb85-15" tabindex="-1"></a></span>
<span id="cb85-16"><a href="#cb85-16" tabindex="-1"></a><span class="co"># Make trace plots for original/base model</span></span>
<span id="cb85-17"><a href="#cb85-17" tabindex="-1"></a><span class="fu">make_trace_plot</span>(</span>
<span id="cb85-18"><a href="#cb85-18" tabindex="-1"></a>  <span class="at">dir                 =</span> dir_nci_traceplot,</span>
<span id="cb85-19"><a href="#cb85-19" tabindex="-1"></a>  <span class="at">multivar.mcmc.model =</span> mcmc_model,</span>
<span id="cb85-20"><a href="#cb85-20" tabindex="-1"></a>  <span class="at">replicate.num       =</span> <span class="dv">0</span></span>
<span id="cb85-21"><a href="#cb85-21" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Trace plots created</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="do">#### End of code 03A ####</span></span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a><span class="co">#                            End of code 03A                              #</span></span>
<span id="cb87-4"><a href="#cb87-4" tabindex="-1"></a><span class="co"># *********************************************************************** #</span></span>
<span id="cb87-5"><a href="#cb87-5" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code></pre></div>
<pre><code>## R version 4.4.3 (2025-02-28)
## Platform: x86_64-apple-darwin20
## Running under: macOS Sonoma 14.7.5
## 
## Matrix products: default
## BLAS:   /System/Library/Frameworks/Accelerate.framework/Versions/A/Frameworks/vecLib.framework/Versions/A/libBLAS.dylib 
## LAPACK: /Library/Frameworks/R.framework/Versions/4.4-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## time zone: America/Toronto
## tzcode source: internal
## 
## attached base packages:
## [1] parallel  stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] furrr_0.3.1        doFuture_1.0.2     foreach_1.5.2      future_1.34.0      tictoc_1.2.1       ncimultivar_1.0.3 
## [7] tidylog_1.1.0      dplyr_1.1.4        data.table_1.17.99
## 
## loaded via a namespace (and not attached):
##  [1] future.apply_1.11.3 compiler_4.4.3      tidyselect_1.2.1    gtsummary_2.1.0     tidyr_1.3.1        
##  [6] globals_0.16.3      yaml_2.3.10         fastmap_1.2.0       here_1.0.1          R6_2.6.1           
## [11] cards_0.5.1         generics_0.1.3      knitr_1.50          iterators_1.0.14    tibble_3.2.1       
## [16] rprojroot_2.0.4     pillar_1.10.2       rlang_1.1.6         xfun_0.52           cli_3.6.5          
## [21] withr_3.0.2         magrittr_2.0.3      digest_0.6.37       rstudioapi_0.17.1   clisymbols_1.2.0   
## [26] lifecycle_1.0.4     vctrs_0.6.5         evaluate_1.0.3      glue_1.8.0          listenv_0.9.1      
## [31] codetools_0.2-20    parallelly_1.43.0   rmarkdown_2.29      purrr_1.0.4         tools_4.4.3        
## [36] pkgconfig_2.0.3     htmltools_0.5.8.1</code></pre>

</body>
</html>
