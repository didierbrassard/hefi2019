---
output: github_document
bibliography: references.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

library(tidyverse)
library(knitr)
library(haven)

# include data
path <- c("/Users/DidierBrassard/SASUniversityEdition/myfolders/CHEI/Validation/Temp/")
mydata <- read_sas(paste0(path,"/scoreacutevf.sas7bdat")) %>% dplyr::rename(RA_qty_nonwgfoods=RA_qty_grfoodsrefined, 
              otherbev=FID_WTG_otherbev)

```

# Healthy Eating Food Index-2019

<!-- badges: start -->

<!-- badges: end -->

## Background

[Canada's Food Guide (CFG) 2019](https://food-guide.canada.ca/en/) includes dietary guidance both on healthy food choices and eating behaviors. The Healthy Eating Food Index (HEFI)-2019 is a scoring tool developed to measure adherence to recommendations on healthy food choices in CFG [@RN1226]. The HEFI-2019 has 10 components, of which 5 are based on the intake of foods, 1 on beverages, and 4 on nutrients. The total HEFI-2019 score has a maximum of 80 points.  

## Scoring algorithm

The goal of the *hefi2019* code is to apply the HEFI-2019 scoring algorithm to dietary constituents in the dataset provided by the user. The original variables are kept in the output data set, along with new variables including:

1.  density of intakes (i.e., ratios of dietary constituents);
2.  the HEFI-2019 component scores; and
3.  the total HEFI-2019 score.

See the development and evaluation articles for more details as well as information on classification of foods [@RN1226; @RN1229]. Of note, when no foods, beverages or energy is reported, ratios are not calculated and a score of 0 is assigned to the corresponding components.

### Suggested layout for the input dataset

The scoring algorithm should ideally be applied to a dataset in the "long" format, where observations are rows and dietary constituents are columns, as shown below. Other layouts are also possible.

```{r inputexample,echo=FALSE}

set.seed(123)
tidyr::tibble(
  Participants = 1:5,
  Food1 = rpois(5,3),
  Food2 = rpois(5,4),
  Food3 = rpois(5,5),
  `Food...` = "..."
) %>% head()

```

[SAS](./SAS/hefi2019.scoring.macro.sas) and [R](./R/hefi2019.scoring.macro.R) versions of the scoring algorithm are available. Both versions will yield the same HEFI-2019 scores and output when applied to the same data. An example application for the R version is shown below.

## R Version

### Installation

You can install the released version of the *hefi2019* from [GitHub](https://github.com) with:

``` r
devtools::install_github("didierbrassard/hefi2019")
```

### Example application

The scoring algorithm is used by indicating the name of the input data set and the name of each variable representing dietary constituents of the HEFI-2019. In the case where a given dietary constituents was not reported in an entire sample, a 0 can be assigned to that variable. Upon execution, the title of the function is displayed.

```{r example}
#library(hefi2019)
devtools::load_all()

# Apply the scoring algorithm to user-provided data
mydata_scored <- hefi2019(indata         = mydata,
                         vegwfruits      = RA_qty_vegwfruit,
                         wholegrfoods    = RA_qty_grfoodswhole,
                         nonwholegrfoods = RA_qty_nonwgfoods,
                         profoodsanimal  = RA_qty_profoodsanimal,
                         profoodsplant   = RA_qty_profoodsplant,
                         otherfoods      = RA_qty_other,
                         water_and_other_healthy = water_and_other_healthy,
                         unsweetmilk     = milk,
                         unsweetplantbevpro = 0, # 0 = food was not consumed
                         otherbev        = otherbev ,
                         mufat           = mufa ,
                         pufat           = pufa ,
                         satfat          = sfa ,
                         sugars          = sugfree,
                         kcal            = energy,
                         sodium          = sodium )

```

## Scoring Algorithm Output

### Density of intakes

The scoring algorithm creates 10 variables for density of intakes: *`r knitr::combine_words(names(mydata_scored %>%  select( starts_with("RATIO"), "SFA_PERC", "SUG_PERC", "SODDEN")))`*.

### Total HEFI-2019 and its components

The variable corresponding to the total HEFI-2019 is *`r noquote(names(mydata_scored %>%  select( starts_with("HEFI"))) [11])`* and the 10 variables corresponding to each component of the HEFI-2019 are *`r  knitr::combine_words(names(mydata_scored %>% select( starts_with("HEFI"))) [1:10])`*.

# References
